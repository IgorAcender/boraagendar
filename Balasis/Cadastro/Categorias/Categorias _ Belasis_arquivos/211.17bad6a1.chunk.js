(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[211],{2958:function(e,t,r){"use strict";r.r(t);var o=r(0),s=r(50),i=r(116),c=r(250),a=r(1438),n=r(608),l=r(19),d=r(22);const b=e=>Object(s.b)("phrases.confirm_delete",{model:Object(s.b)("words.product",{count:e.length}).toLocaleLowerCase(),count:e.length}),u=l.d.div.withConfig({componentId:"wb__sc-1xtwk3m-0"})(["display:flex;width:100%;flex-direction:column;align-items:center;background-color:#fbfbfb;border-radius:5px;box-shadow:0 2px 9px rgba(83,83,83,0.06);overflow:hidden;margin-bottom:15px;padding:10px;border:1px solid transparent;user-select:none;transition:transform .2s;"]);var j=r(37);const _=j.e`
  fragment ProductListCommonAttributes on Product {
    id
    active
    description
    image_blurhash
    image_url: small_thumb_url
    favorite
    price_cents
    quantity
    unit_quantity
    und
  }
`,p=j.e`
  fragment ProductListDesktopAttributes on Product {
    commission
    group_name
    brand_name
    stock_minimum
    code
    bar_code
  }
`,h=j.e`
  query ProductsList (
    $page: Int,
    $results: Int,
    $search_query: String,
    $sort_field: String,
    $sort_order: String,
    $actives: Boolean,
    $favorites: Boolean,
    $group_ids: [ID],
    $brand_ids: [ID],
    $is_mobile: Boolean!,
  ) {
    all_inventory_products (
      page: $page,
      results: $results,
      search_term: $search_query,
      sort_field: $sort_field,
      sort_order: $sort_order,
      actives: $actives,
      favorites: $favorites,
      group_ids: $group_ids,
      brand_ids: $brand_ids,
      service: false,
      use_replica: true
    ) {
      all {
        ...ProductListCommonAttributes

        ...ProductListDesktopAttributes @skip(if: $is_mobile)
      }
      total_count
    }
  }

  ${_}
  ${p}
`,O=j.e`
  query ProductsIdsList ($actives: Boolean, $favorites: Boolean) {
    all_inventory_products (actives: $actives, favorites: $favorites, service: false, use_replica: true) {
      all {
        id active
      }
    },
  }
`;var m=r(2854),v=r(2872),w=r(3034),f=r(1830),g=r(770),y=r(1002),x=r(27),k=r(794),$=r(586),C=r(956),q=r(2921),L=r(1813),I=r(908),D=r(53),S=r.n(D),z=r(18),P=r(547);var N=()=>Object(o.useMemo)((()=>[{title:Object(s.b)("words.origin"),key:"movement_type",dataIndex:"movement_type",width:160,render:(e,t)=>Object(d.jsx)(I.a,{flow:t})},{title:Object(s.b)("words.date"),key:"created_at",dataIndex:"created_at",width:100,sorter:!0,defaultSortOrder:"descend",render:e=>S()(e,z.H).format("L")},{title:Object(s.b)("words.previous"),key:"old_quantity",dataIndex:"old_quantity",width:140,render:(e,t)=>Object(d.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(d.jsxs)(c.h,{$fullWidth:!0,children:[e," (",t.product.und.toLowerCase(),")"]}),Object(d.jsx)(c.h,{$size:10,$color:"gray_1",children:Object(s.b)("products.drawer.composes.unit_equivalent",{quantity:t.old_quantity_normalized,unit:Object(s.b)("words.unit").toLowerCase()})})]})},{title:Object(s.b)("words.movement"),key:"kind",dataIndex:"kind",width:130,ellipsis:!0,render:e=>{const t="+"===e;return Object(d.jsx)(P.a,{color:t?"green":"red",style:{margin:0},children:t?Object(s.b)("words.cash_income"):Object(s.b)("words.cash_outflow")})}},{title:Object(s.b)("words.quantity"),key:"quantity",dataIndex:"quantity",width:140,render:(e,t)=>Object(d.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(d.jsxs)(c.h,{$fullWidth:!0,children:[e," (",t.product.und.toLowerCase(),")"]}),Object(d.jsx)(c.h,{$size:10,$color:"gray_1",children:Object(s.b)("products.drawer.composes.unit_equivalent",{quantity:t.quantity_normalized,unit:Object(s.b)("words.unit").toLowerCase()})})]})},{title:Object(s.b)("words.balance"),key:"current_quantity",dataIndex:"current_quantity",width:140,render:(e,t)=>Object(d.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(d.jsxs)(c.h,{$fullWidth:!0,$bold:!0,children:[e," (",t.product.und.toLowerCase(),")"]}),Object(d.jsx)(c.h,{$size:10,$bold:!0,$color:"gray_1",children:Object(s.b)("products.drawer.composes.unit_equivalent",{quantity:t.current_quantity_normalized,unit:Object(s.b)("words.unit").toLowerCase()})})]})},{title:Object(s.b)("words.employee"),key:"created_by",dataIndex:"created_by",width:"30%",ellipsis:!0,render:e=>null===e||void 0===e?void 0:e.name},{title:Object(s.b)("words.description"),key:"reason",dataIndex:"reason",align:"left",width:"70%",render:e=>Object(d.jsx)(c.h,{title:e,children:e})}]),[]);const T=e=>{let{flows:t,loading:r,handleChangeTable:o}=e;const i=N();return Object(d.jsx)(q.a,{columns:i,dataSource:t,scroll:{y:window.innerHeight-185},loading:r,pagination:!1,rowKey:"id",className:"drawer-table",size:"small",onChange:o,locale:{emptyText:Object(d.jsx)(L.a,{description:Object(s.b)("phrases.empty"),image:L.a.PRESENTED_IMAGE_SIMPLE})}})};T.displayName="FlowsTable";var F=T,A=r(340);const R=(e,t)=>{let{onSave:r}=e;const[s,a]=Object(o.useState)(1),[n,l]=Object(o.useState)(25),[b,u]=Object(o.useState)(""),[j,_]=Object(o.useState)(!1),[p,h]=Object(o.useState)("DESC"),[O,m]=Object(o.useState)("created_at"),v=Object(x.a)((e=>e.current_user.permissions)),w=Object(x.a)((e=>e.is_mobile)),f=Object(o.useRef)(null),{t:g}=Object(A.c)(),{data:q,loading:L,error:I,refetch:D}=Object(C.a)({id:b,page:s,results:n,sort_order:p,sort_field:O}),S=Object(o.useCallback)((e=>{u(e),_(!0)}),[]),z=Object(o.useCallback)((()=>{_(!1)}),[]);Object(o.useImperativeHandle)(t,(()=>({open:S,close:z})));const P=(null===q||void 0===q?void 0:q.product.flows.all)||[],N=(null===q||void 0===q?void 0:q.product.flows.total_count)||0;return Object(d.jsxs)(c.b,{open:j,title:g("products.drawer.stock_movement.stock_movements"),onClose:z,placement:w?"bottom":"right",width:1240,height:"100%",closable:!0,destroyOnHidden:!0,push:!1,footer:Object(d.jsx)(k.a,{loading:L,page:s,results:n,total:N,handleChangePagination:(e,t)=>{a(e),t&&l(t)},close:z,openDrawer:()=>{var e;v.can_edit_product?null===(e=f.current)||void 0===e||e.open():i.b.warning(g("phrases.no_permission_to_do_this"))}}),children:[Object(d.jsx)($.a,{small:!0,visible:!!I,zIndex:5}),Object(d.jsx)(F,{flows:P,loading:L,handleChangeTable:(e,t,r,o)=>{"sort"===o.action&&(Array.isArray(r)||("ascend"===r.order?h("ASC"):"descend"===r.order?h("DESC"):h(void 0),Array.isArray(r.field)||m(r.field)))}}),Object(d.jsx)(y.a,{ref:f,product_id:b,onSave:()=>{D(),null===r||void 0===r||r()}})]})};R.displayName="FlowsDrawer";var E=Object(o.forwardRef)(R),M=r(627),B=r(1041),H=r(1531),W=r(1532),J=r(667);var K=()=>{const e=Object(x.a)((e=>e.inventory_groups)),t=Object(x.a)((e=>e.inventory_brands)),r=e.filter((e=>e.active&&!e.deleted_at)),i=t.filter((e=>e.active));return Object(o.useMemo)((()=>{const e=r.map((e=>({value:e.id,label:e.name}))),t=i.map((e=>({value:e.id,label:e.name})));return[{label:Object(s.b)("words.status"),name:"actives",default_value:"true",double_checkbox:{true:Object(s.b)("words.active",{count:2}),false:Object(s.b)("words.inactive",{count:2})}},{label:Object(s.b)("words.favorite",{count:2}),name:"favorites",default_value:null,double_checkbox:{true:Object(s.b)("phrases.with_star"),false:Object(s.b)("phrases.no_star")}},{label:Object(s.b)("words.category",{count:2}),name:"group_ids",checkbox_options:e},{label:Object(s.b)("words.brand",{count:2}),name:"brand_ids",checkbox_options:t}]}),[i,r])},G=r(2845),Q=r(579),X=r(599),Y=r(583);const U=e=>{const{item:t}=e,r=Object(l.f)();return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{children:Object(d.jsx)(Z,{src:null===t||void 0===t?void 0:t.image_url,blurhash:null===t||void 0===t?void 0:t.image_blurhash})}),Object(d.jsxs)("div",{style:{width:"100%",overflow:"hidden"},children:[Object(d.jsxs)(c.g,{justify:"space-between",children:[Object(d.jsx)(Y.b,{lines:2,width:10,$block:!0,children:null===t||void 0===t?void 0:t.description}),Object(d.jsx)(Y.b,{width:8,$block:!0,$color:"gray_1",$size:14,children:Object(d.jsx)(G.a,{size:22,style:{color:null!==t&&void 0!==t&&t.favorite?r.colors.gold:"lightgray"}})})]}),Object(d.jsxs)(c.g,{justify:"space-between",$top:5,children:[Object(d.jsx)(Y.b,{width:6,$block:!0,$color:"gray_1",$size:12,children:Object(Q.d)(null===t||void 0===t?void 0:t.price_cents)}),Object(d.jsx)(ee,{product:t})]})]})]})};var V=Object(o.memo)(U);const Z=Object(l.d)(X.a).attrs({type:"image"}).withConfig({componentId:"wb__sc-14i0srr-0"})(["width:40px !important;height:40px !important;border-radius:5px !important;margin-right:10px !important;border:1px solid #eee;"]),ee=e=>{var t;let{product:r}=e;const o=null===r||void 0===r?void 0:r.unit_quantity;if(o){const e=parseFloat((r.quantity/o).toFixed(1)),t=e>(r.stock_minimum||0)?"success":"red";return Object(d.jsx)(Y.b,{width:12,$block:!0,$color:t,$size:12,children:Object(s.b)("phrases.number_of_units",{count:e,unit:Object(s.b)("words.unit").toLocaleLowerCase()})})}const i=r?(null===r||void 0===r?void 0:r.quantity)>((null===r||void 0===r?void 0:r.stock_minimum)||0)?"success":"red":"gray_1";return Object(d.jsx)(Y.b,{width:12,$block:!0,$color:i,$size:12,children:Object(s.b)("phrases.number_of_units",{count:(null===r||void 0===r?void 0:r.quantity)||0,unit:null===r||void 0===r||null===(t=r.und)||void 0===t?void 0:t.toLocaleLowerCase()})})};ee.displayName="Quantity";var te=r(852),re=r(616);var oe=e=>{let{openProductDrawer:t,handleDestroyProduct:r,openFlowsDrawer:n,handleFavorite:b}=e;const u=Object(l.f)(),j=Object(x.a)((e=>e.current_user.permissions)),_=Object(o.useCallback)((e=>{j.can_destroy_product?i.c.confirm({centered:!0,className:"webook-modal",title:Object(s.b)("words.attention"),maskClosable:!0,content:Object(s.b)("phrases.confirm_delete",{model:Object(s.b)("words.product").toLocaleLowerCase()}),okText:Object(s.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(s.b)("verbs.cancel"),onOk:()=>r(e)}):i.b.warning(Object(s.b)("phrases.no_permission_to_do_this"))}),[r,j.can_destroy_product]);return Object(o.useMemo)((()=>[{title:Object(s.b)("words.name"),default_visible:!0,always_visible:!0,key:"description",dataIndex:"description",defaultSortOrder:"ascend",className:"table-sort",sorter:!0,width:"50%",render:(e,r)=>Object(d.jsxs)(c.i,{title:e,style:{width:"100%",textAlign:"start"},className:"link text-overflow-ellipsis",onClick:()=>t(r),children:[Object(d.jsx)(X.a,{type:"image",shape:"square",src:r.image_url,size:"small",blurhash:r.image_blurhash}),"\xa0",e]})},{title:Object(s.b)("words.brand"),default_visible:!0,key:"brand_name",dataIndex:"brand_name",ellipsis:!0,width:"25%",render:e=>e||null},{title:Object(s.b)("words.category"),default_visible:!0,key:"group_name",dataIndex:"group_name",ellipsis:!0,width:"25%"},{title:Object(s.b)("products.drawer.register.item_code"),default_visible:!1,align:"right",key:"code",dataIndex:"code",width:140,render:e=>e,sorter:!0},{title:Object(s.b)("products.drawer.register.bar_code"),default_visible:!1,align:"right",key:"bar_code",dataIndex:"bar_code",width:150,render:e=>e,sorter:!0},{title:Object(s.b)("words.stock"),default_visible:!0,key:"quantity",dataIndex:"quantity",width:140,ellipsis:!0,render:(e,t)=>{const r=t.unit_quantity,o=parseFloat((e/r).toFixed(1)),i=o>(t.stock_minimum||0)?"success":"red";return Object(d.jsxs)(c.h,{$color:i,title:Object(s.b)("phrases.number_of_units",{count:o,unit:Object(s.b)("words.unit").toLocaleLowerCase()}),$semibold:!0,onClick:()=>n(t.id),$cursor:"pointer",children:[Object(s.b)("phrases.number_of_units",{count:o,unit:Object(s.b)("words.unit").toLocaleLowerCase()}),"\xa0",Object(d.jsx)(w.a,{})]})},sorter:!0},{title:Object(s.b)("words.sale_price"),default_visible:!0,key:"price_cents",dataIndex:"price_cents",align:"right",width:140,render:e=>Object(Q.d)(e),sorter:!0},{title:Object(s.b)("words.commission"),default_visible:!0,align:"right",key:"commission",dataIndex:"commission",width:100,render:e=>Object(Q.u)(e),sorter:!0},{default_visible:!0,key:"actions",align:"center",width:130,render:(e,r)=>Object(d.jsxs)(re.a,{width:114,children:[Object(d.jsx)(c.i,{className:"link",onClick:()=>b([r.id]),children:Object(d.jsx)(G.a,{size:16,style:{color:r.favorite?u.colors.gold:"lightgray"}})}),Object(d.jsx)(a.a,{type:"vertical"}),Object(d.jsx)(te.a,{title:Object(s.b)("verbs.edit"),placement:"bottom",children:Object(d.jsx)(c.i,{className:"link",onClick:()=>t(r),children:Object(d.jsx)(w.a,{})})}),Object(d.jsx)(a.a,{type:"vertical"}),Object(d.jsx)(c.i,{className:"link color-red",onClick:()=>_(r.id),children:Object(d.jsx)(m.a,{})})]})}]),[_,b,n,t,u.colors.gold])};t.default=()=>{const e=Object(o.useRef)(null),t=Object(o.useRef)(null),r=Object(o.useRef)(null),l=Object(o.useRef)(null),{permissions:j}=Object(x.a)((e=>e.current_user)),[_]=Object(W.a)(),[p]=Object(H.a)(),[y]=Object(B.a)(),k=Object(o.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.refetch()}),[]),$=Object(o.useCallback)((async e=>{if(!j.can_destroy_product)return void i.b.warning(Object(s.b)("phrases.no_permission_to_do_this"));const{success:t,deactivated:r,errors:o}=await _({id:e});return t?(i.b.success(Object(s.b)("phrases.deleted_successfully",{prefix:Object(s.b)("words.product")})),void k()):r?(null===o||void 0===o||o.map((e=>i.b.info(e))),void k()):void(null===o||void 0===o||o.map((e=>i.b.error(e))))}),[_,j.can_destroy_product,k]),C=Object(o.useCallback)((async t=>{const{success:r,failures:o=[]}=await p({ids:t});(r||0!==o.length)&&(e=>{let{ids:t,failures:r=[],magicTableRef:o}=e;const l=r.length===t.length,b=0===r.length,j=r.filter((e=>e.deactivated)),_=t.length-j.length;var p;if(b)return i.b.success(`${t.length} ${Object(s.b)("phrases.deleted_successfully",{prefix:Object(s.b)("words.product",{count:t.length}).toLocaleLowerCase(),count:t.length})}`),void(null===(p=o.current)||void 0===p||p.afterDestroyRecord(t.length));n.a.information({closable:!0,className:"webook-modal hide-buttons",maskClosable:!0,onCancel:()=>{var e;l||null===(e=o.current)||void 0===e||e.afterDestroyRecord(r.length)},title:Object(s.b)("phrases.mass_delete_completed"),content:Object(d.jsxs)("div",{style:{maxHeight:400,width:"100%",maxWidth:480,overflowX:"hidden",overflowY:"auto"},children:[!l&&Object(d.jsxs)(c.h,{$size:16,$alignCenter:!0,$color:"green_2",children:[_,"\xa0",Object(s.b)("phrases.deleted_successfully",{prefix:Object(s.b)("words.product",{count:_}).toLocaleLowerCase(),count:_})]}),r.length>0&&Object(d.jsxs)(c.g,{$column:!0,$paddings:[0,10],children:[Object(d.jsx)(a.a,{dashed:!0}),Object(d.jsxs)(c.h,{$size:16,$alignCenter:!0,$paddings:{bottom:10},children:[r.length,"\xa0",Object(s.b)("phrases.cant_be_deleted",{prefix:Object(s.b)("words.product",{count:r.length}).toLocaleLowerCase(),count:r.length})]}),r.map((e=>{let{inventory_product:t,errors:r=[],deactivated:o=!1}=e;return Object(d.jsxs)(u,{children:[Object(d.jsx)(c.g,{$column:!0,style:{overflow:"hidden"},children:Object(d.jsx)(c.h,{$size:16,$textEllipsis:!0,$block:!0,children:t.description})}),Object(d.jsx)(c.g,{$column:!0,style:{overflow:"hidden"},$mTop:10,children:r.map((e=>Object(d.jsx)(c.h,{$color:o?"gray_1":"red",children:e},`${e}_${t.id}`)))})]},`item_${t.id}`)}))]})]})})})({ids:t,failures:o,magicTableRef:e})}),[p]),q=Object(o.useCallback)((e=>{var r;null===(r=t.current)||void 0===r||r.open({id:null===e||void 0===e?void 0:e.id})}),[]),L=Object(o.useCallback)((e=>{j.can_edit_product?q(e):i.b.warning(Object(s.b)("phrases.no_permission_to_do_this"))}),[q,j.can_edit_product]),I=Object(o.useCallback)((e=>{var t;null===(t=l.current)||void 0===t||t.open(e)}),[]),D=Object(J.a)(j.can_destroy_product,b,C),S=Object(o.useCallback)((async e=>{if(!j.can_edit_product)return void i.b.warning(Object(s.b)("phrases.no_permission_to_do_this"));const{success:t,errors:r}=await y({product_ids:e,field:"favorite"});if(!t)return;const o=e.length-r.length,c=Object(s.b)("phrases.update_successfully",{prefix:Object(s.b)("words.product",{count:o}),count:o});i.b.success(c),k()}),[j.can_edit_product,k,y]),z=oe({openProductDrawer:L,handleDestroyProduct:$,openFlowsDrawer:I,handleFavorite:S}),P=K(),N=Object(o.useCallback)((e=>e),[]),T=Object(o.useMemo)((()=>[{label:Object(s.b)("verbs.delete"),icon:Object(d.jsx)(m.a,{}),danger:!0,onClick:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=e.map((e=>e.id||e));D(t)}},{label:Object(s.b)("words.favorite"),icon:Object(d.jsx)(v.a,{twoToneColor:"#f9b60c"}),title:Object(s.b)("phrases.reverse_favorite"),onClick:e=>{const t=e.map((e=>e.id));S(t)}},{label:Object(s.b)("verbs.edit"),icon:Object(d.jsx)(w.a,{className:"link"}),onClick:e=>{var t;if(!j.can_edit_product)return void i.b.warning(Object(s.b)("phrases.no_permission_to_do_this"));const o=e.map((e=>e.id));null===(t=r.current)||void 0===t||t.open(o)}}]),[S,D,j.can_edit_product]);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(M.a,{ref:e,title:Object(s.b)("words.product",{count:2}),permissions_key:"product",rowSelectorKey:N,search_placeholder:Object(s.b)("products.search_placeholder"),filters:P,mass_actions:T,columns:z,query:h,item_selectable:!1,select_all_query:O,getData:e=>{var t;return null===e||void 0===e||null===(t=e.all_inventory_products)||void 0===t?void 0:t.all},getTotalCount:e=>{var t;return(null===e||void 0===e||null===(t=e.all_inventory_products)||void 0===t?void 0:t.total_count)||0},MobileItem:V,openDrawer:q}),Object(d.jsx)(g.a,{ref:t,afterSave:k}),Object(d.jsx)(f.a,{ref:r,is_service:!1,afterSave:k}),Object(d.jsx)(E,{ref:l})]})}}}]);
//# sourceMappingURL=211.17bad6a1.chunk.js.map