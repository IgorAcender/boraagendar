(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[122],{2872:function(e,t,a){"use strict";var s=a(13),c=a(0),n={icon:function(e,t){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512.5 190.4l-94.4 191.3-211.2 30.7 152.8 149-36.1 210.3 188.9-99.3 188.9 99.2-36.1-210.3 152.8-148.9-211.2-30.7z",fill:t}},{tag:"path",attrs:{d:"M908.6 352.8l-253.9-36.9L541.2 85.8c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L370.3 315.9l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1L239 839.4a31.95 31.95 0 0046.4 33.7l227.1-119.4 227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM665.3 561.3l36.1 210.3-188.9-99.2-188.9 99.3 36.1-210.3-152.8-149 211.2-30.7 94.4-191.3 94.4 191.3 211.2 30.7-152.8 148.9z",fill:e}}]}},name:"star",theme:"twotone"},i=a(71),r=function(e,t){return c.createElement(i.a,Object(s.a)({},e,{ref:t,icon:n}))},l=c.forwardRef(r);t.a=l},2951:function(e,t,a){"use strict";a.r(t);var s=a(0),c=a(50),n=a(116),i=a(2854),r=a(2872),l=a(37);const o=l.e`
  query PaymentsList($active: Boolean, $search_query: String, $sort_field: String, $sort_order: String) {
    finance_payments(
      active: $active,
      search_query: $search_query,
      sort_field: $sort_field,
      sort_order: $sort_order,
      use_replica: true
    ) {
      id
      name
      auto
      active
      account_id
      rates
      fixed_rate
      processing_days
      favorite
      is_cash

      account {
        id name
      }
    }
  }
`,d=l.e`
  query PaymentsIdsList($active: Boolean) {
    finance_payments(active: $active, use_replica: true) {
      id active
    }
  }
`;var b=a(2937),j=a(250),u=a(1850),m=a(76);const O=l.e`
  mutation AdvanceDrawerSaveAdvance ($data: SavePaymentInput!) {
    savePayment (input: $data) {
      success
      errors
    }
  }
`;var h=()=>{const[e,{loading:t}]=Object(u.a)(O);return[async t=>{try{const{data:a}=await e({variables:{data:t}}),{success:s=!1,errors:c=[]}=(null===a||void 0===a?void 0:a.savePayment)||{};return null===c||void 0===c||c.forEach((e=>n.b.error(e))),{success:s}}catch(a){return m.a.captureException(a),n.b.error(Object(c.b)("phrases.generic_save_error_message")),console.error(a),{success:!1}}},{loading:t}]},p=a(27),y=a(339),_=a(2879);const v=l.e`
  query PaymentModal($id: ID) {
    finance_payment(id: $id) {
      id name auto rates fixed_rate processing_days active account_id kind consider_rates favorite
    }
  }
`;var f=e=>Object(_.a)(v,{fetchPolicy:"network-only",onCompleted:t=>{e(t.finance_payment)},onError:e=>{m.a.captureException(e),console.log(e)}}),g=a(340),x=a(2853),w=a(579),k=a(543),C=a(2824),$=a(2883),P=a(1256),I=a(2838),L=a(3023),M=a(1227),N=a(665),S=a(646),q=a(342),F=a(22);const V=e=>{let{is_cash:t,setFieldsValue:a}=e;const s=Object(p.a)((e=>e.is_mobile));return Object(F.jsxs)(k.a,{gutter:8,children:[Object(F.jsx)(b.a.Item,{name:"id",noStyle:!0,children:Object(F.jsx)(C.a,{type:"hidden"})}),Object(F.jsx)($.a,{span:24,children:Object(F.jsx)(b.a.Item,{name:"name",label:Object(c.b)("words.name"),rules:[{required:!0,message:Object(c.b)("phrases.required_field")}],children:Object(F.jsx)(C.a,{size:s?"large":void 0,placeholder:Object(c.b)("words.name")})})}),Object(F.jsx)($.a,{span:24,children:Object(F.jsx)(b.a.Item,{name:"kind",label:Object(c.b)("words.type"),initialValue:0,children:Object(F.jsxs)(P.a,{size:s?"large":void 0,onChange:e=>{3===e||a({consider_rates:!1})},disabled:t,children:[Object(F.jsx)(P.a.Option,{value:0,children:Object(c.b)("words.other",{count:2})}),Object(F.jsx)(P.a.Option,{value:1,children:Object(c.b)("words.payment_book")}),Object(F.jsx)(P.a.Option,{value:2,children:Object(c.b)("menu.belasis_pay")}),Object(F.jsx)(P.a.Option,{value:3,children:Object(c.b)("words.card")}),Object(F.jsx)(P.a.Option,{value:4,disabled:!0,children:Object(c.b)("words.cash")}),Object(F.jsx)(P.a.Option,{value:5,children:Object(c.b)("finance.registrations.payment.belasis_pay_card")}),Object(F.jsx)(P.a.Option,{value:6,children:Object(c.b)("finance.registrations.payment.belasis_pay_pix")})]})})}),Object(F.jsx)($.a,{xs:24,sm:12,children:Object(F.jsx)(b.a.Item,{name:"fixed_rate",tooltip:Object(F.jsx)(g.a,{i18nKey:"finance.registrations.payment.fixed_rate_tooltip"}),label:Object(F.jsxs)(F.Fragment,{children:[" ",Object(c.b)("finance.registrations.payment.fixed_rate")," ",Object(F.jsx)(q.c,{date:"2025/09/15"})]}),initialValue:0,children:Object(F.jsx)(I.a,{placeholder:Object(w.d)(0),min:0,step:100,formatter:e=>Object(w.d)(e,{cents:!1}),parser:e=>parseInt((e||"0").replace(/\D/g,""))/100,size:s?"large":"middle",inputMode:"decimal",style:{width:"100%"},className:"hide-number-button"})})}),Object(F.jsx)($.a,{xs:24,sm:12,children:Object(F.jsx)(b.a.Item,{name:"rates",tooltip:Object(F.jsx)(g.a,{i18nKey:"finance.registrations.payment.rate_tooltip",components:[Object(F.jsx)("br",{})]}),label:Object(c.b)("words.rate"),initialValue:0,children:Object(F.jsx)(N.a,{size:s?"large":void 0})})}),Object(F.jsx)($.a,{xs:24,sm:24,children:Object(F.jsx)(b.a.Item,{name:"processing_days",tooltip:Object(F.jsx)(g.a,{i18nKey:"finance.registrations.payment.processing_days_tooltip",components:[Object(F.jsx)("br",{}),Object(F.jsx)("strong",{})]}),label:Object(c.b)("finance.registrations.payment.processing_days"),rules:[{required:!0,message:Object(c.b)("phrases.required_field")}],initialValue:0,children:Object(F.jsx)(I.a,{size:s?"large":void 0,inputMode:"numeric",placeholder:Object(c.b)("finance.registrations.payment.number_days",{number:0}),style:{width:"100%"}})})}),Object(F.jsx)($.a,{span:24,children:Object(F.jsx)(b.a.Item,{name:"account_id",tooltip:Object(c.b)("finance.registrations.payment.linked_account_tooltip"),label:Object(c.b)("finance.registrations.payment.linked_account"),rules:[{required:!0,message:Object(c.b)("phrases.required_field")}],children:Object(F.jsx)(S.a,{size:s?"large":void 0})})}),Object(F.jsx)($.a,{span:24,children:Object(F.jsxs)(k.a,{align:"middle",children:[Object(F.jsx)(b.a.Item,{style:{marginBottom:5},name:"auto",valuePropName:"checked",initialValue:!1,children:Object(F.jsx)(L.a,{})}),"\xa0",Object(c.b)("finance.registrations.payment.automatic_discharge")]})}),Object(F.jsx)($.a,{span:24,children:Object(F.jsxs)(k.a,{align:"middle",children:[Object(F.jsx)(b.a.Item,{style:{marginBottom:5},name:"favorite",valuePropName:"checked",initialValue:!1,children:Object(F.jsx)(L.a,{})}),"\xa0",Object(c.b)("words.favorite")]})}),Object(F.jsx)(b.a.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.kind!==t.kind,children:e=>{let{getFieldValue:t}=e;return 3===t("kind")?Object(F.jsx)($.a,{span:24,children:Object(F.jsxs)(k.a,{align:"middle",children:[Object(F.jsx)(b.a.Item,{style:{marginBottom:5},name:"consider_rates",valuePropName:"checked",initialValue:!1,children:Object(F.jsx)(L.a,{})}),"\xa0",Object(c.b)("finance.registrations.payment.deduct_interest_rate"),Object(F.jsx)(M.a,{trigger:"click",title:Object(c.b)("finance.registrations.payment.deduct_interest_rate"),content:Object(F.jsx)(j.h,{$align:"justify",$block:!0,style:{width:250},children:Object(c.b)("finance.registrations.payment.deduct_interest_rate_tooltip")}),children:Object(F.jsx)(x.a,{style:{marginLeft:5}})})]})}):null}}),!t&&Object(F.jsx)($.a,{span:24,children:Object(F.jsxs)(k.a,{align:"middle",children:[Object(F.jsx)(b.a.Item,{style:{marginBottom:5},name:"active",valuePropName:"checked",initialValue:!0,children:Object(F.jsx)(L.a,{})}),"\xa0",Object(c.b)("words.active_female")]})})]})};V.displayName="PaymentForm";var z=V,D=a(581);const T=(e,t)=>{let{onSave:a}=e;const[i,r]=Object(s.useState)(!1),[l,o]=Object(s.useState)(!1),[d]=b.a.useForm(),{setFieldsValue:u,resetFields:m,submit:O}=d,_=Object(p.a)((e=>e.is_mobile)),[v,{loading:g,error:x}]=f(u),w=e=>{e&&(v({variables:{id:e.id}}),o(e.is_cash)),r(!0)},k=Object(s.useCallback)((()=>{r(!1)}),[]);Object(s.useImperativeHandle)(t,(()=>({open:w,close:k})));const[C,{loading:$}]=h(),P=Object(s.useCallback)((async e=>{const{success:t}=await C(e);t&&(n.b.success(Object(c.b)("phrases.saved_successfully",{prefix:Object(c.b)("words.payment_type"),context:"female"})),null===a||void 0===a||a(),k())}),[k,a,C]);return Object(F.jsxs)(j.a,{open:i,title:Object(c.b)("words.payment_type"),placement:_?"bottom":"right",height:"100%",onClose:k,width:480,closable:!0,destroyOnClose:!0,afterOpenChange:e=>{e||(m(),o(!1))},footer:Object(F.jsx)(D.a,{loading:$||g,disabled:!!x,submit:O,close:k}),children:[Object(F.jsx)(y.a,{loading:g}),Object(F.jsxs)(b.a,{form:d,layout:"vertical",onFinish:P,scrollToFirstError:!0,children:[Object(F.jsx)("button",{type:"submit",hidden:!0}),Object(F.jsx)(z,{is_cash:l,setFieldsValue:u})]})]})};T.displayName="PaymentDrawer";var B=Object(s.memo)(Object(s.forwardRef)(T)),E=a(627),R=a(667),A=a(190);const K=l.e`
  mutation PaymentsListDestroyPayment($data: DestroyPaymentInput!) {
    destroyPayment(input: $data) {
      success errors
    }
  }
`;var H=()=>{const[e,t]=Object(s.useState)(!1),[a]=Object(u.a)(K);return{destroyPayments:Object(s.useCallback)((async(e,s)=>{t(!0);const i=n.b.loading(`${Object(c.b)("verbs.wait")}...`,0),r=[],l=[],o=e.map((e=>new Promise(((t,s)=>{a({variables:{data:{id:e}}}).then((t=>{let{data:a}=t;const{success:s}=(null===a||void 0===a?void 0:a.destroyPayment)||{};if(!s)return l.push(e);r.push(e)})).catch((()=>{l.push(e)})).then((()=>{t(!0)}))}))));await Promise.all(o).then((()=>{t(!1),i(),s(e.length-l.length),l.length>0&&n.b.error(`${l.length} ${Object(c.b)("phrases.cant_be_deleted",{prefix:Object(c.b)("words.payment_type",{count:l.length}).toLocaleLowerCase(),count:l.length,context:"female"})}`),r.length>0&&n.b.success(`${r.length} ${Object(c.b)("phrases.deleted_successfully",{prefix:Object(c.b)("words.payment_type",{count:r.length}).toLocaleLowerCase(),count:r.length,context:"female"})}`)}))}),[a]),is_destroying:e}};const J=l.e`
  mutation UpdatePaymentMethod ($data: SavePaymentInput!) {
    savePayment(input: $data) {
      success
    }
  }
`;var U=()=>{const[e,{loading:t}]=Object(u.a)(J);return[async t=>{const a=n.b.loading(`${Object(c.b)("verbs.wait")}...`,0),s=[],i=[],r=t.map((t=>{let{id:a,favorite:c}=t;return new Promise(((t,n)=>{e({variables:{data:{id:a,favorite:c}}}).then((e=>{let{data:t}=e;const{success:c}=(null===t||void 0===t?void 0:t.savePayment)||{};if(!c)return i.push(a);s.push(a)})).catch((()=>{i.push(a)})).then((()=>{t(!0)}))}))}));return await Promise.all(r).then((()=>(a(),{successes:s,failures:i})))},t]},W=a(593),G=a(583),Q=a(19);const X=e=>{let{item:t}=e;return Object(F.jsx)(Z,{children:Object(F.jsx)(G.b,{width:12,$block:!0,children:null===t||void 0===t?void 0:t.name})})};X.displayName="PaymentItemMobile";var Y=Object(s.memo)(X);const Z=Q.d.div.withConfig({componentId:"wb__sc-16bwj9y-0"})(["overflow:hidden;padding:4px 0;display:flex;align-items:center;justify-content:center;"]);var ee=a(547),te=a(1438),ae=a(852),se=a(616),ce=a(2845),ne=a(3034);var ie=e=>{let{openAccountModal:t,handleDestroyPaymentMethods:a,handleFavorite:r}=e;const l=Object(Q.f)(),o=Object(s.useCallback)((e=>{n.c.confirm({centered:!0,className:"webook-modal",title:Object(c.b)("words.attention"),maskClosable:!0,content:Object(c.b)("phrases.confirm_delete",{model:Object(c.b)("words.payment_type").toLocaleLowerCase(),context:"female"}),okText:Object(c.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(c.b)("verbs.cancel"),onOk:()=>a([e])})}),[a]);return Object(s.useMemo)((()=>[{title:Object(c.b)("words.name"),default_visible:!0,always_visible:!0,key:"name",dataIndex:"name",defaultSortOrder:"ascend",className:"table-sort",sorter:!0,render:(e,a)=>Object(F.jsx)(j.i,{style:{maxWidth:"100%"},title:e,onClick:()=>t(a),children:e})},{title:Object(c.b)("words.rate"),default_visible:!0,width:130,key:"rates",dataIndex:"rates",render:(e,t)=>{let{fixed_rate:a}=t;return e||a?a?e?`${Object(w.d)(a,{cents:!1})} + ${e}%`:Object(w.d)(a,{cents:!1}):`${e}%`:"-"}},{title:Object(c.b)("words.account"),default_visible:!0,ellipsis:!0,key:"account",dataIndex:"account",render:e=>e.name},{title:Object(c.b)("finance.registrations.payment.processing_days"),default_visible:!0,key:"processing_days",dataIndex:"processing_days",render:e=>Object(c.b)("finance.registrations.payment.available_in_days",{count:e})},{title:Object(c.b)("finance.registrations.payment.financial_discharge"),default_visible:!0,width:150,key:"auto",dataIndex:"auto",render:e=>e?Object(F.jsx)(ee.a,{color:"green",children:Object(c.b)("finance.registrations.payment.automatic_discharge")}):Object(F.jsx)(ee.a,{color:"blue",children:Object(c.b)("finance.registrations.payment.manual_discharge")})},{default_visible:!0,key:"actions",align:"center",width:120,render:e=>Object(F.jsxs)(se.a,{width:104,children:[Object(F.jsx)(j.i,{className:"link",onClick:()=>r([{id:e.id,favorite:!e.favorite}]),children:Object(F.jsx)(ce.a,{size:16,style:{color:e.favorite?l.colors.gold:"lightgray"}})}),Object(F.jsx)(te.a,{type:"vertical"}),Object(F.jsx)(ae.a,{title:Object(c.b)("verbs.edit"),placement:"bottom",children:Object(F.jsx)(j.i,{className:"link",onClick:()=>t(e),children:Object(F.jsx)(ne.a,{})})}),!e.is_cash&&Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(te.a,{type:"vertical"}),Object(F.jsx)(j.i,{className:"link color-red",onClick:()=>o(e.id),children:Object(F.jsx)(i.a,{})})]})]})}]),[o,r,t,l.colors.gold])};var re=()=>Object(s.useMemo)((()=>[{label:Object(c.b)("words.status"),name:"active",default_value:"true",double_checkbox:{true:Object(c.b)("words.activated"),false:Object(c.b)("words.deactivated")}}]),[]),le=a(1433);t.default=()=>{Object(W.a)({feature_keys:["has_finance_customization"]});const e=Object(p.a)((e=>e.current_user.permissions)),[t]=U(),{destroyPayments:a}=H(),l=Object(A.c)(),b=Object(s.useRef)(null),j=Object(s.useRef)(null),u=Object(s.useCallback)((()=>{var e;null===(e=j.current)||void 0===e||e.refetch(),l()}),[l]),m=Object(s.useCallback)((e=>{a(e,(e=>{var t;null===(t=j.current)||void 0===t||t.afterDestroyRecord(e),l()}))}),[a,l]),O=Object(s.useCallback)((e=>Object(c.b)("phrases.confirm_delete",{model:Object(c.b)("words.payment_type",{count:e.length}).toLocaleLowerCase(),count:e.length})),[]),h=Object(R.a)(!0,O,m),y=Object(s.useCallback)((e=>{var t;null===(t=b.current)||void 0===t||t.open(e)}),[]),_=Object(s.useCallback)((async e=>{const{successes:a,failures:s}=await t(e);var i;a.length>0&&(n.b.success(`${a.length} ${Object(c.b)("phrases.saved_successfully",{prefix:Object(c.b)("words.payment",{count:a.length}).toLocaleLowerCase(),count:a.length})}`),null===(i=j.current)||void 0===i||i.refetch());s.length>0&&n.b.error(`${s.length} ${Object(c.b)("phrases.cant_be_saved",{prefix:Object(c.b)("words.payment",{count:s.length}).toLocaleLowerCase(),count:s.length})}`)}),[t]),v=Object(s.useMemo)((()=>[{label:Object(c.b)("verbs.delete"),icon:Object(F.jsx)(i.a,{}),danger:!0,onClick:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=e.map((e=>e.id||e));h(t)}},{label:Object(c.b)("words.favorite"),icon:Object(F.jsx)(r.a,{twoToneColor:"#f9b60c"}),title:Object(c.b)("phrases.reverse_favorite"),onClick:e=>{const t=e.map((e=>({id:e.id,favorite:!e.favorite})));_(t)},disabled:!e.is_admin}]),[_,h,e.is_admin]),f=Object(s.useCallback)((e=>e.active?"":"disabled"),[]),g=Object(s.useCallback)((e=>e),[]);return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(E.a,{ref:j,Header:le.a,title:Object(c.b)("words.record",{count:2}),storage_key:"formas_pagamento_financeiro",search_placeholder:Object(c.b)("input.search_by_name"),filters:re(),permissions:{can_create:e.is_admin,can_edit:e.is_admin,can_access:e.is_admin},columns:ie({openAccountModal:y,handleDestroyPaymentMethods:m,handleFavorite:_}),query:o,mass_actions:v,select_all_query:d,getData:e=>null===e||void 0===e?void 0:e.finance_payments,getTotalCount:e=>{var t;return(null===e||void 0===e||null===(t=e.finance_payments)||void 0===t?void 0:t.length)||0},MobileItem:Y,openDrawer:y,validateRow:()=>!0,rowClassName:f,rowSelectorKey:g}),Object(F.jsx)(B,{ref:b,onSave:u})]})}},667:function(e,t,a){"use strict";var s=a(0),c=a(50),n=a(116);t.a=(e,t,a)=>Object(s.useCallback)((s=>{e?n.c.confirm({centered:!0,className:"webook-modal",title:Object(c.b)("words.attention"),maskClosable:!0,content:t(s),okText:Object(c.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(c.b)("verbs.cancel"),onOk:()=>{a(s)}}):n.b.warning(Object(c.b)("phrases.no_permission_to_do_this"))}),[a,e,t])}}]);
//# sourceMappingURL=122.7ccfbd10.chunk.js.map