(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[156],{2952:function(e,t,c){"use strict";c.r(t);var a=c(0),s=c(50),n=c(2854),o=c(37);const l=o.e`
  query AccountsList($active: Boolean, $search_query: String, $sort_field: String, $sort_order: String) {
    finance_accounts(
      active: $active,
      search_query: $search_query,
      sort_field: $sort_field,
      sort_order: $sort_order,
      use_replica: true
    ) {
      id
      name
      active
      cash
      admin_only
    }
  }
`,r=o.e`
  query AccountsIdsList($active: Boolean) {
    finance_accounts(active: $active, use_replica: true) {
      id active
    }
  }
`;var i=c(2937),b=c(250),d=c(27),u=c(116),j=c(1850),m=c(76);const O=o.e`
  mutation saveAccount($data: SaveAccountInput!) {
    saveAccount(input: $data) {
      success errors
    }
  }
`;var h=()=>{const[e,{loading:t}]=Object(j.a)(O);return[async t=>{try{const{data:c}=await e({variables:{data:t}}),{success:a=!1,errors:s=[]}=(null===c||void 0===c?void 0:c.saveAccount)||{};return null===s||void 0===s||s.forEach((e=>u.b.error(e))),{success:a}}catch(c){return m.a.captureException(c),u.b.error(Object(s.b)("phrases.generic_save_error_message")),console.error(c),{success:!1}}},{loading:t}]},_=c(2879);const v=o.e`
  query AccountModal($id: ID) {
    finance_account(id: $id) {
      id name cash admin_only active associated_payment_gateway balance_cents
    }
  }
`;var p=e=>Object(_.a)(v,{fetchPolicy:"network-only",onCompleted:t=>{const c={...t.finance_account,admin_only:t.finance_account.admin_only?1:0};e(c)},onError:e=>{m.a.captureException(e),console.log(e)}}),y=c(1256),f=c(543),x=c(2824),g=c(2883),w=c(3023),k=c(584),C=c(22);const{Option:$}=y.a,A=()=>{const e=Object(d.a)((e=>e.is_mobile));return Object(C.jsxs)(f.a,{gutter:8,children:[Object(C.jsx)(i.a.Item,{name:"id",noStyle:!0,children:Object(C.jsx)(x.a,{type:"hidden",autoComplete:"off"})}),Object(C.jsx)(i.a.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.id!==t.id,children:t=>{let{getFieldValue:c}=t;const a=!!c("id");return Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(g.a,{span:a?24:16,children:Object(C.jsx)(i.a.Item,{name:"name",label:Object(s.b)("words.name"),rules:[{required:!0,message:Object(s.b)("phrases.required_field")}],children:Object(C.jsx)(x.a,{size:e?"large":"middle",placeholder:Object(s.b)("words.name")})})}),Object(C.jsx)(g.a,{span:a?0:8,children:Object(C.jsx)(i.a.Item,{name:"balance_cents",label:Object(s.b)("words.balance"),children:Object(C.jsx)(k.a,{size:e?"large":"middle"})})})]})}}),Object(C.jsx)(g.a,{span:24,children:Object(C.jsx)(i.a.Item,{name:"admin_only",label:Object(s.b)("words.access"),initialValue:0,children:Object(C.jsxs)(y.a,{size:e?"large":"middle",children:[Object(C.jsx)($,{value:0,children:Object(s.b)("finance.registrations.account.available_all_users")}),Object(C.jsx)($,{value:1,children:Object(s.b)("finance.registrations.account.only_admin")})]})})}),Object(C.jsx)(g.a,{span:24,children:Object(C.jsxs)(f.a,{align:"middle",children:[Object(C.jsx)(i.a.Item,{style:{marginBottom:5},name:"associated_payment_gateway",valuePropName:"checked",initialValue:null,getValueFromEvent:e=>e?"zoop":null,getValueProps:e=>({checked:"zoop"===e}),children:Object(C.jsx)(w.a,{})}),"\xa0",Object(s.b)("menu.belasis_pay")]})}),Object(C.jsx)(g.a,{span:24,children:Object(C.jsxs)(f.a,{align:"middle",children:[Object(C.jsx)(i.a.Item,{style:{marginBottom:5},name:"active",valuePropName:"checked",initialValue:!0,children:Object(C.jsx)(w.a,{})}),"\xa0",Object(s.b)("words.active_female")]})})]})};A.displayName="AccountForm";var I=A,N=c(581),F=c(339);const L=(e,t)=>{let{onSave:c}=e;const[n,o]=Object(a.useState)(!1),[l]=i.a.useForm(),{submit:r,setFieldsValue:j,resetFields:m}=l,O=Object(d.a)((e=>e.is_mobile)),[_,{loading:v,error:y}]=p(j),f=e=>{e&&_({variables:{id:e.id}}),o(!0)},x=Object(a.useCallback)((()=>o(!1)),[]);Object(a.useImperativeHandle)(t,(()=>({open:f,close:x})));const[g,{loading:w}]=h(),k=Object(a.useCallback)((async e=>{let{balance_cents:t,admin_only:a,...n}=e;const o={...n,balance_cents:n.id?void 0:t,admin_only:!!a},{success:l}=await g(o);l&&(u.b.success(Object(s.b)("phrases.saved_successfully",{prefix:Object(s.b)("words.account"),context:"female"})),null===c||void 0===c||c(),x())}),[x,c,g]);return Object(C.jsxs)(b.a,{open:n,title:Object(s.b)("finance.registrations.account.bank_account"),onClose:x,placement:O?"bottom":"right",height:"100%",closable:!0,width:480,destroyOnClose:!0,afterOpenChange:e=>!e&&m(),footer:Object(C.jsx)(N.a,{loading:w||v,submit:r,disabled:!!y,close:x}),children:[Object(C.jsx)(F.a,{loading:v}),Object(C.jsxs)(i.a,{form:l,layout:"vertical",onFinish:k,scrollToFirstError:!0,children:[Object(C.jsx)("button",{type:"submit",hidden:!0}),Object(C.jsx)(I,{})]})]})};L.displayName="AccountDrawer";var S=Object(a.memo)(Object(a.forwardRef)(L)),q=c(627),D=c(667),M=c(215),T=c(593);const z=o.e`
  mutation AccountsListDestroyAccount($data: DestroyFinanceAccountInput!) {
    destroyAccount(input: $data) {
      success errors
    }
  }
`;var V=()=>{const[e,t]=Object(a.useState)(!1),[c]=Object(j.a)(z);return{destroyAccounts:Object(a.useCallback)((async(e,a)=>{t(!0);const n=u.b.loading(`${Object(s.b)("verbs.wait")}...`,0),o=[],l=[],r=e.map((e=>new Promise(((t,a)=>{c({variables:{data:{id:e}}}).then((t=>{let{data:c}=t;const{success:a}=(null===c||void 0===c?void 0:c.destroyAccount)||{};if(!a)return l.push(e);o.push(e)})).catch((()=>{l.push(e)})).then((()=>{t(!0)}))}))));await Promise.all(r).then((()=>{t(!1),n(),a(e.length-l.length),l.length>0&&u.b.error(`${l.length} ${Object(s.b)("phrases.cant_be_deleted",{prefix:Object(s.b)("words.account",{count:l.length}).toLocaleLowerCase(),count:l.length,context:"female"})}`),o.length>0&&u.b.success(`${o.length} ${Object(s.b)("phrases.deleted_successfully",{prefix:Object(s.b)("words.account",{count:o.length}).toLocaleLowerCase(),count:o.length,context:"female"})}`)}))}),[c]),is_destroying:e}},E=c(583),P=c(19);const R=e=>{let{item:t}=e;return Object(C.jsx)(H,{children:Object(C.jsx)(E.b,{width:12,$block:!0,children:null===t||void 0===t?void 0:t.name})})};R.displayName="AccountItemMobile";var B=Object(a.memo)(R);const H=P.d.div.withConfig({componentId:"wb__sc-hfzmbm-0"})(["overflow:hidden;padding:4px 0;display:flex;align-items:center;justify-content:center;"]);var J=c(852),U=c(1438),G=c(616),K=c(3034);var Q=e=>{let{openAccountModal:t,handleDestroyAccounts:c}=e;const o=Object(a.useCallback)((e=>{u.c.confirm({centered:!0,className:"webook-modal",title:Object(s.b)("words.attention"),maskClosable:!0,content:Object(s.b)("phrases.confirm_delete",{model:Object(s.b)("words.account").toLocaleLowerCase(),context:"female"}),okText:Object(s.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(s.b)("verbs.cancel"),onOk:()=>c([e])})}),[c]);return Object(a.useMemo)((()=>[{title:Object(s.b)("words.name"),default_visible:!0,always_visible:!0,key:"name",dataIndex:"name",defaultSortOrder:"ascend",className:"table-sort",sorter:!0,ellipsis:!0,render:(e,c)=>Object(C.jsx)(b.i,{title:e,className:"link text-overflow-ellipsis",onClick:()=>t(c),children:e})},{title:Object(s.b)("words.detail",{count:2}),key:"details",default_visible:!0,width:250,render:(e,t)=>t.cash?Object(s.b)("words.cash_account"):t.admin_only?Object(s.b)("finance.registrations.account.only_admin"):void 0},{default_visible:!0,key:"actions",align:"center",width:100,render:e=>e.cash?null:Object(C.jsxs)(G.a,{width:84,children:[Object(C.jsx)(J.a,{title:Object(s.b)("verbs.edit"),placement:"bottom",children:Object(C.jsx)(b.i,{className:"link",onClick:()=>t(e),children:Object(C.jsx)(K.a,{})})}),Object(C.jsx)(U.a,{type:"vertical"}),Object(C.jsx)(b.i,{className:"link color-red",onClick:()=>o(e.id),children:Object(C.jsx)(n.a,{})})]})}]),[o,t])};var W=()=>Object(a.useMemo)((()=>[{label:Object(s.b)("words.status"),name:"active",default_value:"true",double_checkbox:{true:Object(s.b)("words.activated"),false:Object(s.b)("words.deactivated")}}]),[]),X=c(1433);t.default=()=>{Object(T.a)({feature_keys:["has_finance_customization"]});const e=Object(d.a)((e=>e.current_user.permissions)),t=Object(a.useRef)(null),c=Object(a.useRef)(null),{destroyAccounts:o}=V(),i=Object(M.b)(),b=Object(a.useCallback)((()=>{var e;null===(e=t.current)||void 0===e||e.refetch(),i()}),[i]),u=Object(a.useCallback)((e=>{o(e,(e=>{var c;null===(c=t.current)||void 0===c||c.afterDestroyRecord(e),b()}))}),[o,b]),j=Object(a.useCallback)((e=>Object(s.b)("phrases.confirm_delete",{model:Object(s.b)("words.account",{count:e.length}).toLocaleLowerCase(),count:e.length})),[]),m=Object(D.a)(!0,j,u),O=Object(a.useCallback)((e=>{var t;null!==e&&void 0!==e&&e.cash||null===(t=c.current)||void 0===t||t.open(e)}),[]),h=Object(a.useMemo)((()=>[{label:Object(s.b)("verbs.delete"),icon:Object(C.jsx)(n.a,{}),danger:!0,onClick:m}]),[m]),_=Object(a.useCallback)((e=>!(null!==e&&void 0!==e&&e.cash)),[]),v=Object(a.useCallback)((e=>e.cash||!e.active?"disabled":""),[]);return Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(q.a,{ref:t,Header:X.a,title:Object(s.b)("words.record",{count:2}),storage_key:"contas_financeiro",search_placeholder:Object(s.b)("input.search_by_name"),filters:W(),permissions:{can_create:e.is_admin,can_edit:e.is_admin,can_access:e.is_admin},columns:Q({openAccountModal:O,handleDestroyAccounts:u}),query:l,mass_actions:h,select_all_query:r,getData:e=>null===e||void 0===e?void 0:e.finance_accounts,getTotalCount:e=>{var t;return(null===e||void 0===e||null===(t=e.finance_accounts)||void 0===t?void 0:t.length)||0},MobileItem:B,openDrawer:O,validateRow:_,rowClassName:v}),Object(C.jsx)(S,{ref:c,onSave:b})]})}},667:function(e,t,c){"use strict";var a=c(0),s=c(50),n=c(116);t.a=(e,t,c)=>Object(a.useCallback)((a=>{e?n.c.confirm({centered:!0,className:"webook-modal",title:Object(s.b)("words.attention"),maskClosable:!0,content:t(a),okText:Object(s.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(s.b)("verbs.cancel"),onOk:()=>{c(a)}}):n.b.warning(Object(s.b)("phrases.no_permission_to_do_this"))}),[c,e,t])}}]);
//# sourceMappingURL=156.c45d7c7a.chunk.js.map