(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[66],{1004:function(e,t,s){"use strict";var a=s(13),n=s(0),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M296 256c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm192 200v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8zm-48 396H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm104.1-115.6c1.8-34.5 16.2-66.8 40.8-91.4 26.2-26.2 62-41 99.1-41 37.4 0 72.6 14.6 99.1 41 3.2 3.2 6.3 6.6 9.2 10.1L769.2 673a8 8 0 003 14.1l93.3 22.5c5 1.2 9.8-2.6 9.9-7.7l.6-95.4a8 8 0 00-12.9-6.4l-20.3 15.8C805.4 569.6 748.1 540 684 540c-109.9 0-199.6 86.9-204 195.7-.2 4.5 3.5 8.3 8 8.3h48.1c4.3 0 7.8-3.3 8-7.6zM880 744h-48.1c-4.3 0-7.8 3.3-8 7.6-1.8 34.5-16.2 66.8-40.8 91.4-26.2 26.2-62 41-99.1 41-37.4 0-72.6-14.6-99.1-41-3.2-3.2-6.3-6.6-9.2-10.1l23.1-17.9a8 8 0 00-3-14.1l-93.3-22.5c-5-1.2-9.8 2.6-9.9 7.7l-.6 95.4a8 8 0 0012.9 6.4l20.3-15.8C562.6 918.4 619.9 948 684 948c109.9 0 199.6-86.9 204-195.7.2-4.5-3.5-8.3-8-8.3z"}}]},name:"file-sync",theme:"outlined"},i=s(71),l=function(e,t){return n.createElement(i.a,Object(a.a)({},e,{ref:t,icon:c}))},r=n.forwardRef(l);t.a=r},1040:function(e,t,s){"use strict";var a=s(0),n=s(37),c=s(405);const i=n.e`
  query FetchDocumentTemplates ($class_type: String) {
    document_templates (class_type: $class_type, page: 1, per_page: 10) {
      all {
        id name
      }
    }
  }
`;t.a=e=>{const{data:t}=Object(c.f)(i,{variables:{class_type:e}});return Object(a.useMemo)((()=>(null===t||void 0===t?void 0:t.document_templates.all)||[]),[null===t||void 0===t?void 0:t.document_templates.all])}},1102:function(e,t,s){"use strict";var a=s(13),n=s(0),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},i=s(71),l=function(e,t){return n.createElement(i.a,Object(a.a)({},e,{ref:t,icon:c}))},r=n.forwardRef(l);t.a=r},1223:function(e,t,s){"use strict";var a=s(13),n=s(0),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.7 630.2 359 721.7 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.7 758.3 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM184 352V232h64v207.6a91.99 91.99 0 01-64-87.6zm520 128c0 49.1-19.1 95.4-53.9 130.1-34.8 34.8-81 53.9-130.1 53.9h-16c-49.1 0-95.4-19.1-130.1-53.9-34.8-34.8-53.9-81-53.9-130.1V184h384v296zm136-128c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"outlined"},i=s(71),l=function(e,t){return n.createElement(i.a,Object(a.a)({},e,{ref:t,icon:c}))},r=n.forwardRef(l);t.a=r},1301:function(e,t,s){"use strict";s(0);var a=s(547),n=s(19),c=s(22);const i=e=>{let{label:t,id:s,status:a,disabled:n}=e;const i=n?"#808080":"",r=s?(e=>({issued:"#4eb660",canceled:"#faa84f",pending:"#1194f6",denied:"#e44e4d",cancel_denied:"#e44e4d"}[e]||"#1194f6"))(a):i;return Object(c.jsx)(l,{color:r,children:t})};i.displayName="InvoiceTag",t.a=i;const l=Object(n.d)(a.a).withConfig({componentId:"wb__sc-1jitx2m-0"})(["width:60px;text-align:center;"])},2941:function(e,t,s){"use strict";s.r(t);var a=s(0),n=s(50),c=s(116),i=s(2854),l=s(37);const r=l.e`
  query InventorySalesList(
    $deleted: Boolean, $page: Int, $results: Int, $search_query: String, $start_date: String, $end_date: String, $status: ID,
    $payment: [ID], $payment_status: [ID]

    $payment_method: Boolean!,
  ) {
    inventory_sales(
      deleted: $deleted, page: $page, results: $results, search: $search_query, start_date: $start_date, end_date: $end_date,
      status: $status, payment: $payment, payment_status: $payment_status, sort_field: "ID", sort_order: "DESC",
      group: "id"
    ) {
      total_count
      all {
        id number code sum_cents finished date comment discount_cents deleted_at schedule_group_id

        client {
          id name deleted_at
        }

        sale_items {
          id
          package_item_id
          subscription_item_id
          offers_sale_item_id
          kind_points
          discount_cents
          product {
            id service
          }
        }

        bill_recs {
          id status cash_accounting_id

          payment @include(if: $payment_method) {
            id name kind
          }

          cash_accounting {
            id code
          }
        }

        electronic_invoice {
          id status_reason status document_id xml_file_link pdf_file_link
        }

        electronic_consumer_invoice {
          id status_reason status document_id xml_file_link pdf_file_link
        }

        invoice {
          id status pdf_link xml_link status_reason
        }

        audits(action: "destroy") {
          id
          user {
            id email
          }
        }
      }
    }
  }
`,o=l.e`
  query InventorySalesIdsQuery(
    $search_query: String,
    $start_date: String,
    $end_date: String,
    $status: ID,
    $payment: [ID],
    $payment_status: [ID],
    $sort_field: String,
    $sort_order: String,
  ) {
    inventory_sales(
      search: $search_query,
      start_date: $start_date,
      end_date: $end_date,
      status: $status,
      payment: $payment,
      payment_status: $payment_status,
      sort_field: $sort_field,
      sort_order: $sort_order,
    ) {
      all {
        id deleted_at
      }
    }
  }
`;l.e`
  query FetchDocumentTemplates {
    document_templates (class_type: "Inventory::Sale", page: 1, per_page: 100) {
      all {
        id name
      }
    }
  }
`;var d=s(1438),b=s(608),u=s(250),_=s(19),j=s(22);const m=e=>{let{ids:t,failures:s,magicTableRef:a,isDestroy:i=!1,texts:l}=e;const r=s.length===t.length,o=0===s.length,_=t.length-s.length,m=Object(n.b)(l.successPrefix,{count:_}).toLocaleLowerCase();var v;if(o)return i?c.b.success(`${_} ${Object(n.b)(l.successKey,{prefix:m,count:_,context:"female"})}`):c.b.success(l.successMessage),void(null===(v=a.current)||void 0===v||v.afterDestroyRecord(_));b.a.information({closable:!0,className:"webook-modal hide-buttons",maskClosable:!0,onCancel:()=>{var e;r||null===(e=a.current)||void 0===e||e.afterDestroyRecord(_)},title:l.title,content:Object(j.jsxs)("div",{style:{maxHeight:400,width:"100%",maxWidth:480,overflowX:"hidden",overflowY:"auto"},children:[!r&&Object(j.jsx)(u.h,{$size:16,$alignCenter:!0,$color:"green_2",children:i?`${_} ${Object(n.b)(l.successKey,{prefix:m,count:_,context:"female"})}`:Object(n.b)(l.successKey,{model:m,count:_,context:"female"})}),s.length>0&&Object(j.jsxs)(u.g,{$column:!0,$paddings:[0,10],children:[Object(j.jsx)(d.a,{dashed:!0}),Object(j.jsx)(u.h,{$size:16,$alignCenter:!0,$paddings:{bottom:10},children:Object(n.b)(l.failureMessageKey,{model:Object(n.b)("words.sale",{count:s.length}).toLocaleLowerCase(),count:s.length,context:"female"})}),s.map((e=>{let{id:t,code:s,errors:a=[]}=e;return Object(j.jsxs)(h,{children:[Object(j.jsx)(u.g,{$column:!0,style:{overflow:"hidden"},children:Object(j.jsxs)(u.h,{$size:16,$textEllipsis:!0,$block:!0,children:[Object(n.b)("words.ticket"),"\xa0#",s]})}),Object(j.jsx)(u.g,{$column:!0,style:{overflow:"hidden"},$mTop:10,children:a.map((e=>Object(j.jsx)(u.h,{style:{color:"#FF7875"},children:e},`${e}_${t}`)))})]},`sale_failure_item_${t}`)}))]})]})})},v=e=>Object(n.b)("phrases.confirm_delete_female",{model:Object(n.b)("words.sale",{count:e.length}).toLocaleLowerCase(),count:e.length,context:"female"}),h=_.d.div.withConfig({componentId:"wb__sc-11kuqzk-0"})(["display:flex;width:100%;flex-direction:column;align-items:center;background-color:#fbfbfb;border-radius:5px;box-shadow:0 2px 9px rgba(83,83,83,0.06);overflow:hidden;margin-bottom:15px;padding:10px;border:1px solid transparent;user-select:none;transition:transform .2s;"]);var p=s(627),O=s(613),f=s(596),y=s(853),g=s(667),x=s(27),w=s(1808),k=s(1814),$=s(18),C=s(593);var I=e=>{const t=Object(x.a)((e=>{var t;return null===(t=e.current_user.salon.enotas_token)||void 0===t?void 0:t.token})),s=Object(x.a)((e=>e.current_user.addons.has_nfs))&&!!t,i=Object(C.b)();return Object(a.useCallback)((t=>{if(!s)return void i({is_addon:!0,search:$.a.ID_NEW_INVOICE});if(t.length>50)return void c.b.warning(Object(n.b)("invoices.mass_issue.limited",{max:50}));let l=!0,r=!0;const o=()=>{const[e,t]=Object(a.useState)(!0),[s,c]=Object(a.useState)(!0);return l=e,r=s,Object(j.jsxs)(j.Fragment,{children:[Object(n.b)("invoices.mass_issue.confirm_mass_issue"),Object(j.jsx)(k.a,{checked:e,onChange:e=>t(e.target.checked),children:Object(n.b)("invoices.mass_issue.send_client_data")}),Object(j.jsx)(k.a,{checked:s,onChange:e=>c(e.target.checked),children:Object(n.b)("invoices.mass_issue.send_client_address")})]})};c.c.confirm({centered:!0,className:"webook-modal",title:Object(n.b)("invoices.issue_invoice"),maskClosable:!0,content:Object(j.jsx)(o,{}),okText:Object(n.b)("words.yes"),okType:"danger",cancelText:Object(n.b)("verbs.cancel"),onOk:()=>{e(t,l,r)}})}),[i,e,s])},D=s(1850);const S=l.e`
  mutation MassIssueInvoice($data: MassIssueInvoiceInput!) {
    massIssueInvoice(input: $data) {
      success
      failures { id code errors }
    }
  }
`;var M=()=>{const[e]=Object(D.a)(S);return[async t=>{const s=c.b.loading(`${Object(n.b)("verbs.wait")}...`,0);try{const{data:a}=await e({variables:{data:t}}),{success:n=!1,failures:c=[]}=(null===a||void 0===a?void 0:a.massIssueInvoice)||{};return{success:n,failures:c}}catch(a){return c.b.error(Object(n.b)("phrases.generic_save_error_message")),console.error(a),{success:!1}}finally{s()}}]};const H=l.e`
  mutation DestroyAllInventorySales($data: DestroyAllInventorySalesInput!) {
    destroyAllInventorySales(input: $data) {
      success
      failures { id code errors }
      errors
    }
  }
`;var z=()=>{const[e]=Object(D.a)(H);return[async t=>{const s=c.b.loading(`${Object(n.b)("verbs.wait")}...`,0);try{const{data:a}=await e({variables:{data:t}}),{success:n=!1,failures:i=[],errors:l=[]}=(null===a||void 0===a?void 0:a.destroyAllInventorySales)||{};return null===l||void 0===l||l.map((e=>c.b.error(e))),{success:n,failures:i||[]}}catch(a){return c.b.error(Object(n.b)("phrases.generic_save_error_message")),console.error(a),{success:!1,failures:[]}}finally{s()}}]},L=s(616),R=s(579),F=s(3038),V=s(547),T=s(852),N=s(1421),E=s(1422),q=s(1040),P=s(1453),B=s(1809),A=s(1825),K=s(1440),Y=s(3034),G=s(787),Z=s(1088),W=s(3048),J=s(691);const Q=e=>{var t,s;const{sale:l,document_templates:r,destroySale:o,openDrawer:b,openGenerateDocumentModal:_}=e,m=Object(x.a)((e=>e.current_user.permissions)),v=Object(x.a)((e=>e.current_user.addons.has_document_template)),h=null===(t=(null===(s=l.bill_recs)||void 0===s?void 0:s.find((e=>e.cash_accounting_id)))||{})||void 0===t?void 0:t.cash_accounting,p=Object(a.useCallback)((()=>{null!==m&&void 0!==m&&m.can_destroy_sale?c.c.confirm({centered:!0,className:"webook-modal",title:Object(n.b)("words.attention"),maskClosable:!0,content:Object(n.b)("phrases.confirm_delete_female",{model:Object(n.b)("words.sale").toLocaleLowerCase(),context:"female"}),okText:Object(n.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(n.b)("verbs.cancel"),onOk:()=>o(l.id)}):c.b.warning(Object(n.b)("phrases.no_permission_to_do_this"))}),[o,null===m||void 0===m?void 0:m.can_destroy_sale,l.id]),O=Object(a.useMemo)((()=>0===r.length?[{key:"empty-document",label:"Nenhum gerador encontrado",disabled:!0}]:r.map((e=>({key:e.id,label:`${Object(n.b)("verbs.generate")} ${e.name}`,icon:Object(j.jsx)(A.a,{}),onClick:()=>_({document_template_id:e.id,inventory_sale_id:l.id})})))),[r,_,l.id]),f=Object(a.useMemo)((()=>{const e=[{key:"see-sale",title:l.finished?Object(n.b)("verbs.view"):Object(n.b)("verbs.edit"),icon:l.finished?Object(j.jsx)(K.a,{}):Object(j.jsx)(Y.a,{}),label:`${l.finished?Object(n.b)("verbs.see"):Object(n.b)("verbs.edit")} `+Object(n.b)("words.sale").toLocaleLowerCase(),onClick:()=>{null!==m&&void 0!==m&&m.can_edit_sale?b(l):c.b.warning(Object(n.b)("phrases.no_permission_to_do_this"))}},{key:"print",icon:Object(j.jsx)(A.a,{}),onClick:()=>window.open(`/reports/sale/${l.id}`,"_blank","noopener, noreferrer"),label:Object(n.b)("verbs.print")},{key:"report-thermal-printer",icon:Object(j.jsx)(G.a,{}),onClick:()=>window.open(`/reports/sale/${l.id}?report_thermal_printer=true`,"_blank","noopener, noreferrer"),label:Object(n.b)("sale.thermal_print")}];return v&&e.push({key:"document_templates",icon:Object(j.jsx)(Z.a,{}),label:Object(n.b)("document_templates.generate_document"),className:"hidden-right-arrow",children:O}),e.push({key:"divider",type:"divider"},{key:"destroy",danger:!0,icon:Object(j.jsx)(i.a,{}),label:Object(n.b)("verbs.delete"),onClick:p}),e}),[p,O,v,b,null===m||void 0===m?void 0:m.can_edit_sale,l]);return Object(j.jsxs)(u.g,{justify:"center",children:[!!h&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(T.a,{title:Object(n.b)("sale.verified_cash_closing",{number:h.code}),placement:"left",children:Object(j.jsx)("span",{style:{color:"#FF9800"},children:Object(j.jsx)(W.a,{})})}),Object(j.jsx)(d.a,{type:"vertical"})]}),Object(j.jsx)(B.a,{menu:{items:f},trigger:["click"],overlayStyle:{width:190},children:Object(j.jsx)(u.i,{className:"link",children:Object(j.jsx)(J.a,{})})})]})};Q.displayName="ActionsColumn";var U=Object(a.memo)(Q),X=s(1223),ee=s(3044),te=s(3056),se=s(854);const ae=e=>{let{sale:t}=e;const s=t.sale_items.some((e=>e.package_item_id)),c=t.sale_items.some((e=>e.offers_sale_item_id)),i=t.sale_items.some((e=>"-"===e.kind_points)),l=t.sale_items.some((e=>e.subscription_item_id)),r=Object(a.useMemo)((()=>t.bill_recs||[]),[t.bill_recs]),o=Object(a.useMemo)((()=>r.some((e=>"0"===e.status))||!t.finished?{color:"orange",name:Object(n.b)("words.open")}:t.finished?r.some((e=>"2"===e.status))?{color:"red",name:Object(n.b)("words.overdue")}:r.some((e=>"4"===e.status))?{color:"blue",name:Object(n.b)("words.available")}:r.some((e=>"5"===e.status))?{color:"#777777",name:Object(n.b)("words.blocked")}:{color:"green",name:Object(n.b)("words.paid")}:{icon:void 0,color:void 0,name:void 0}),[r,t.finished]),d=Object(a.useMemo)((()=>{const e=[];if(s&&e.push(Object(n.b)("words.package").toLocaleLowerCase()),c&&e.push(Object(n.b)("words.offer").toLocaleLowerCase()),i&&e.push(Object(n.b)("sale.fidelity_points").toLocaleLowerCase()),l&&e.push(Object(n.b)("words.subscription").toLocaleLowerCase()),e.length)return Object(n.b)("sale.has_item_type",{models:e.join(", ")})}),[i,c,s,l]);return Object(j.jsx)(T.a,{title:d,children:Object(j.jsxs)(V.a,{color:o.color,children:[o.name,i&&Object(j.jsxs)(j.Fragment,{children:["\xa0-\xa0",Object(j.jsx)(X.a,{})]}),s&&Object(j.jsxs)(j.Fragment,{children:["\xa0-\xa0",Object(j.jsx)(ee.a,{})]}),c&&Object(j.jsxs)(j.Fragment,{children:["\xa0-\xa0",Object(j.jsx)(te.a,{})]}),l&&Object(j.jsxs)(j.Fragment,{children:["\xa0-\xa0",Object(j.jsx)(se.a,{})]})]})})};ae.displayName="PaymentTag";var ne=Object(a.memo)(ae),ce=s(53),ie=s.n(ce);var le=e=>{let{openDrawer:t,handleDestroySale:s,clientDrawerRef:i,refetch:l,openGenerateDocumentModal:r}=e;const o=Object(x.a)((e=>e.current_user.permissions)),d=Object(x.a)((e=>e.is_webook)),b=Object(x.a)((e=>{var t;return null===(t=e.current_user.salon.enotas_token)||void 0===t?void 0:t.token})),_=Object(x.a)((e=>e.current_user.addons.has_nfs))&&!!b,m=Object(x.a)((e=>e.current_user.addons.has_nfe))&&!!b,v=Object(x.a)((e=>e.current_user.addons.has_nfce))&&!!b,h=Object(q.a)("Inventory::Sale");return Object(a.useMemo)((()=>{let e=[{title:Object(n.b)("words.ticket"),dataIndex:"code",key:"code",defaultSortOrder:"descend",width:80,align:"center",always_visible:!0,render:(e,s)=>{var a;return null!==(a=s.client)&&void 0!==a&&a.deleted_at?`#${e}`:Object(j.jsxs)(u.i,{onClick:()=>{o.can_edit_sale?t(s):c.b.warning(Object(n.b)("phrases.no_permission_to_do_this"))},children:["#",e]})}},{title:Object(n.b)("words.number"),key:"number",dataIndex:"number",width:80,ellipsis:!0,align:"left",default_visible:!1,render:e=>Object(j.jsx)("span",{title:e,children:e})},{title:Object(n.b)("words.date"),dataIndex:"date",key:"date",width:100,default_visible:!0,render:e=>ie()(e).format("L")},{title:Object(n.b)("words.client"),key:"client",dataIndex:"client",align:"left",width:"40%",always_visible:!0,render:e=>null!==e&&void 0!==e&&e.deleted_at?Object(j.jsx)("span",{title:Object(n.b)("phrases.client_deleted"),children:e.name}):Object(j.jsx)(u.i,{style:{maxWidth:"100%"},title:null===e||void 0===e?void 0:e.name,onClick:()=>{var t;o.can_edit_client?null===(t=i.current)||void 0===t||t.open({id:null===e||void 0===e?void 0:e.id}):c.b.warning(Object(n.b)("phrases.no_permission_to_do_this"))},children:null===e||void 0===e?void 0:e.name})},{title:Object(n.b)("words.status"),key:"status",dataIndex:"finished",default_visible:!0,width:80,render:e=>e?Object(j.jsx)(V.a,{color:"#777777",children:Object(n.b)("words.finished")}):Object(j.jsx)(V.a,{color:"orange",children:Object(n.b)("words.pending")})},{title:Object(n.b)("words.value"),key:"sum_cents",dataIndex:"sum_cents",align:"right",default_visible:!0,ellipsis:!0,width:100,render:(e,t)=>{const s=(t.sale_items||[]).reduce(((e,t)=>e+(t.discount_cents||0)),0)+((null===t||void 0===t?void 0:t.discount_cents)||0);return Object(j.jsxs)("div",{style:{wordBreak:"keep-all",whiteSpace:"nowrap"},children:[s>0&&Object(j.jsx)(T.a,{title:Object(n.b)("sale.discount_value",{value:Object(R.d)(s)}),children:Object(j.jsx)(F.a,{style:{color:"#52c41a",marginRight:4}})}),Object(R.d)(e)]})}},{title:Object(n.b)("words.payment"),key:"bill_recs",dataIndex:"bill_recs",default_visible:!0,width:100,render:(e,t)=>Object(j.jsx)(ne,{sale:t})},{title:Object(n.b)("words.payment_type"),key:"payment_method",default_visible:!1,include_key_on_query:!0,ellipsis:!0,width:"35%",render:(e,t)=>{var s;return Array.from(new Set(null===(s=t.bill_recs)||void 0===s?void 0:s.map((e=>{var t;return null===(t=e.payment)||void 0===t?void 0:t.name})))).join(", ")}},{title:Object(n.b)("words.observation"),key:"comment",dataIndex:"comment",default_visible:!1,ellipsis:!0,align:"left",width:"25%",render:e=>Object(j.jsx)("span",{title:e,children:e})}];return d||e.push({title:Object(n.b)("words.invoice"),key:"invoices",dataIndex:"invoices",default_visible:!0,ellipsis:!0,align:"center",width:100,render:(e,t)=>{if(!t)return null;const s=t.sale_items.some((e=>e.product.service)),a=t.sale_items.some((e=>!e.product.service));return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(P.a,{has_service:s,can_issue:_,sale_finished:t.finished,invoice:t.invoice,sale_id:t.id,type:"Inventory::Sale",refetch:l}),Object(j.jsx)("span",{style:{marginLeft:10},children:Object(j.jsx)(E.a,{has_product:a,can_issue:m,sale_finished:t.finished,electronic_invoice:t.electronic_invoice,type:"Inventory::Sale",sale_id:t.id,refetch:l})}),Object(j.jsx)("span",{style:{marginLeft:10},children:Object(j.jsx)(N.a,{has_product:a,can_issue:v,sale_finished:t.finished,electronic_consumer_invoice:t.electronic_consumer_invoice,sale_id:t.id,type:"Inventory::Sale",refetch:l})})]})}}),e.push({key:"actions",align:"center",always_visible:!0,width:70,render:(e,a)=>!a.deleted_at&&Object(j.jsx)(L.a,{width:54,style:{height:46,paddingRight:0},children:Object(j.jsx)(U,{sale:a,document_templates:h,openGenerateDocumentModal:r,destroySale:s,openDrawer:t})})}),e}),[i,h,s,v,m,_,d,t,r,o.can_edit_client,o.can_edit_sale,l])};const re=[{value:"finished",label:Object(j.jsx)(V.a,{color:"#777777",children:Object(n.b)("words.finished")})},{value:"pending",label:Object(j.jsx)(V.a,{color:"orange",children:Object(n.b)("words.pending")})}],oe=[{value:"5",label:Object(j.jsx)(V.a,{style:{margin:"2px 0"},color:"#777777",children:Object(n.b)("words.blocked")})},{value:"4",label:Object(j.jsx)(V.a,{style:{margin:"2px 0"},color:"blue",children:Object(n.b)("words.available")})},{value:"0",label:Object(j.jsx)(V.a,{style:{margin:"2px 0"},color:"orange",children:Object(n.b)("words.open")})},{value:"2",label:Object(j.jsx)(V.a,{style:{margin:"2px 0"},color:"red",children:Object(n.b)("words.overdue")})},{value:"3",label:Object(j.jsx)(V.a,{style:{margin:"2px 0"},color:"green",children:Object(n.b)("words.paid")})}];var de=()=>{const e=Object(x.a)((e=>e.finance_payments)).filter((e=>e.active));return Object(a.useMemo)((()=>{const t=e.map((e=>({value:e.id,label:e.name})));return[{label:Object(n.b)("words.status"),name:"deleted",default_value:"all",double_checkbox:{true:Object(n.b)("words.deleted",{count:2,context:"female"}),false:Object(n.b)("words.not_deleted",{count:2,context:"female"})}},{label:Object(n.b)("words.period"),name:"date",rangepicker:{start_date_name:"start_date",end_date_name:"end_date"}},{label:Object(n.b)("words.payment_status"),name:"status",radio_options:re},{label:Object(n.b)("words.payment"),help:Object(n.b)("sale.tooltip.filter_payment"),name:"payment_status",checkbox_options:oe,checkbox_disabled:!0},{label:Object(n.b)("words.payment_type"),name:"payment",checkbox_options:t,checkbox_disabled:!0}]}),[e])},be=s(583),ue=s(604),_e=s(543),je=s(1301);const me=e=>{var t,s,a,n,c,i;let{sale:l}=e;const r=Object(x.a)((e=>{var t;return null===(t=e.current_user.salon.enotas_token)||void 0===t?void 0:t.token})),o=Object(x.a)((e=>e.current_user.addons.has_nfs))&&!!r,d=Object(x.a)((e=>e.current_user.addons.has_nfe))&&!!r,b=Object(x.a)((e=>e.current_user.addons.has_nfce))&&!!r,u=l.finished,_=l.sale_items.some((e=>e.product.service)),m=l.sale_items.some((e=>!e.product.service));return r?Object(j.jsxs)(_e.a,{style:{paddingTop:5},children:[o&&Object(j.jsx)(je.a,{label:"NFS-e",id:null===(t=l.invoice)||void 0===t?void 0:t.id,status:null===(s=l.invoice)||void 0===s?void 0:s.status,disabled:!_||!u}),d&&Object(j.jsx)(je.a,{label:"NF-e",id:null===(a=l.electronic_invoice)||void 0===a?void 0:a.id,status:null===(n=l.electronic_invoice)||void 0===n?void 0:n.status,disabled:!m||!u}),b&&Object(j.jsx)(je.a,{label:"NFC-e",id:null===(c=l.electronic_consumer_invoice)||void 0===c?void 0:c.id,status:null===(i=l.electronic_consumer_invoice)||void 0===i?void 0:i.status,disabled:!m||!u})]}):null};me.displayName="Invoices";var ve=me;const he=e=>{var t,s,a,c,i;const{item:l}=e,r=(null===l||void 0===l||null===(t=l.bill_recs)||void 0===t||null===(s=t.filter((e=>e.payment)))||void 0===s?void 0:s.map((e=>e.payment.name)).join(", "))||"",o=null===l||void 0===l||null===(a=l.audits)||void 0===a||null===(c=a[0])||void 0===c?void 0:c.user,d=((null===l||void 0===l?void 0:l.sale_items)||[]).reduce(((e,t)=>e+(t.discount_cents||0)),0)+((null===l||void 0===l?void 0:l.discount_cents)||0);return Object(j.jsxs)(u.g,{$column:!0,children:[Object(j.jsxs)(u.g,{justify:"space-between",children:[Object(j.jsxs)(be.b,{$block:!0,$textEllipsis:!0,$isFlex:!0,width:22,children:[Object(j.jsxs)(u.h,{$color:"primary",$bold:!0,$right:3,children:["#",null===l||void 0===l?void 0:l.code]})," ",null===l||void 0===l||null===(i=l.client)||void 0===i?void 0:i.name]}),Object(j.jsxs)(be.b,{onClick:e=>e.stopPropagation(),width:6,$align:"right",$block:!0,$semibold:!0,children:[d>0&&Object(j.jsx)(T.a,{title:Object(n.b)("sale.discount_value",{value:Object(R.d)(d)}),children:Object(j.jsx)(F.a,{style:{color:"#52c41a",marginRight:6}})}),Object(R.d)(null===l||void 0===l?void 0:l.sum_cents)]})]}),Object(j.jsxs)(u.g,{$top:5,justify:"space-between",children:[Object(j.jsxs)(be.b,{width:8,$block:!0,$color:"gray_1",$size:12,$isFlex:!0,$textEllipsis:!0,children:[ie()(null===l||void 0===l?void 0:l.date).format("L"),r?` - ${r}`:""]}),fe(l)]}),Object(j.jsx)(u.g,{children:l&&Object(j.jsx)(ve,{sale:l})}),!(null===l||void 0===l||!l.deleted_at)&&Object(j.jsx)(u.g,{$top:5,children:Object(j.jsxs)(u.h,{$color:"gray_1",$size:12,children:[Object(n.b)("sale.order_deleted_on_date",{number:l.code,date:ie()(l.deleted_at,"YYYY-MM-DD HH:mm:ss ZZ").format("L, HH:mm[h]"),interpolation:{escapeValue:!1}}),!!o&&` ${Object(n.b)("words.by").toLocaleLowerCase()} ${o.email}`]})})]})};he.displayName="SaleItemMobile";var pe=Object(a.memo)(he);const Oe=Object(_.d)(V.a).withConfig({componentId:"wb__sc-15lb7ec-0"})(["margin-right:0 !important;width:75px;text-align:center;"]),fe=e=>e?e.finished?Object(j.jsx)(Oe,{color:"#777777",children:Object(n.b)("words.finished")}):Object(j.jsx)(Oe,{color:"#fdb730",children:Object(n.b)("words.pending")}):Object(j.jsx)(ue.a,{width:"8ch"});fe.displayName="getStatus";var ye=s(966),ge=s(2883);const xe=e=>{var t,s;let{sale:a}=e;const c=null===(t=a.audits)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.user;return Object(j.jsx)(_e.a,{className:"disabled",children:Object(j.jsxs)(ge.a,{offset:1,span:12,children:[Object(n.b)("sale.order_deleted_on_date",{number:a.code,date:ie()(a.deleted_at,"YYYY-MM-DD HH:mm:ss ZZ").format("L, HH:mm[h]"),interpolation:{escapeValue:!1}}),!!c&&` ${Object(n.b)("words.by").toLocaleLowerCase()} ${c.email}`]})},a.id)};xe.displayName="ExpandedRow";var we=xe;const ke={true:!0,false:!1,all:null,none:null};t.default=()=>{const e=Object(a.useRef)(null),t=Object(a.useRef)(null),s=Object(a.useRef)(null),l=Object(a.useRef)(null),d=Object(x.a)((e=>e.current_user.permissions)),b=Object(a.useCallback)((()=>{var e;null===(e=s.current)||void 0===e||e.refetch()}),[]),[u]=z(),[_]=Object(ye.a)(),[h]=M(),k=Object(a.useCallback)((async e=>{const{success:t,failures:a=[]}=await u({ids:e});(t||0!==a.length)&&m({ids:e,failures:a,magicTableRef:s,isDestroy:!0,texts:{successMessage:"",successPrefix:"words.sale",successKey:"phrases.deleted_successfully",failureMessageKey:"phrases.failure_destroy_message",title:Object(n.b)("phrases.mass_delete_completed")}})}),[u]),$=Object(a.useCallback)((async e=>{const{success:t}=await _({id:e});t&&(c.b.success(Object(n.b)("phrases.deleted_successfully",{prefix:Object(n.b)("words.sale"),context:"female"})),b())}),[_,b]),C=Object(a.useCallback)((async(e,t,a)=>{const{success:i,failures:l=[]}=await h({ids:e,type:"Inventory::Sale",send_client:t,send_client_address:a});i?m({ids:e,failures:l,magicTableRef:s,texts:{successMessage:Object(n.b)("invoices.mass_issue.all_issued"),successPrefix:"words.sale",successKey:"invoices.mass_issue.issued_message",failureMessageKey:"invoices.mass_issue.failure_issue_message",title:Object(n.b)("invoices.mass_issue.process_started")}}):c.b.error(Object(n.b)("invoices.mass_issue.error_on_issue"))}),[h]),D=Object(g.a)(d.can_destroy_sale,v,k),S=I(C),H=Object(a.useCallback)((t=>{var s;const a=!(null===t||void 0===t||!t.deleted_at);null===(s=e.current)||void 0===s||s.open({sale_id:null===t||void 0===t?void 0:t.id,with_deleted:a})}),[]),L=Object(a.useCallback)((e=>{var t;null===(t=l.current)||void 0===t||t.open(e)}),[]),R=Object(a.useMemo)((()=>({openDrawer:H,clientDrawerRef:t,handleDestroySale:$,refetch:b,openGenerateDocumentModal:L})),[$,H,L,b]),F=le(R),V=de(),T=Object(a.useMemo)((()=>({expandIconColumnIndex:-1,rowExpandable:e=>!!e.deleted_at,expandedRowRender:e=>Object(j.jsx)(we,{sale:e})})),[]),N=Object(a.useCallback)((e=>!(null!==e&&void 0!==e&&e.deleted_at)),[]),E=Object(a.useCallback)((e=>e.filter((e=>!!e.deleted_at)).map((e=>e.id))),[]),q=Object(a.useMemo)((()=>[{label:Object(n.b)("invoices.issue_invoice"),icon:Object(j.jsx)(w.a,{style:{marginInlineEnd:8}}),onClick:S},{label:Object(n.b)("verbs.delete"),icon:Object(j.jsx)(i.a,{}),danger:!0,onClick:D}]),[S,D]),P=Object(a.useCallback)((e=>{const t={},s={},a="pending"===e.status;return Object.entries(e).forEach((e=>{let[n,c]=e;const i=["payment_status","payment"].includes(n)&&a;s[n]=i?[]:c,c in ke&&(t[n]=ke[c])})),{...s,...t}}),[]);return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(p.a,{ref:s,mass_actions:q,openDrawer:H,permissions_key:"sale",search_placeholder:Object(n.b)("sale.search_placeholder"),title:Object(n.b)("words.sale",{count:2}),filters:V,columns:F,query:r,MobileItem:pe,select_all_query:o,getData:e=>{var t;return null===e||void 0===e||null===(t=e.inventory_sales)||void 0===t?void 0:t.all},getTotalCount:e=>{var t;return(null===e||void 0===e||null===(t=e.inventory_sales)||void 0===t?void 0:t.total_count)||0},validateRow:N,expandable:T,expandedRowKeys:E,parseFilters:P}),Object(j.jsx)(O.a,{ref:e,afterSave:b}),Object(j.jsx)(f.a,{ref:t,onSave:b}),Object(j.jsx)(y.a,{ref:l})]})}},667:function(e,t,s){"use strict";var a=s(0),n=s(50),c=s(116);t.a=(e,t,s)=>Object(a.useCallback)((a=>{e?c.c.confirm({centered:!0,className:"webook-modal",title:Object(n.b)("words.attention"),maskClosable:!0,content:t(a),okText:Object(n.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(n.b)("verbs.cancel"),onOk:()=>{s(a)}}):c.b.warning(Object(n.b)("phrases.no_permission_to_do_this"))}),[s,e,t])},691:function(e,t,s){"use strict";var a=s(13),n=s(0),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},i=s(71),l=function(e,t){return n.createElement(i.a,Object(a.a)({},e,{ref:t,icon:c}))},r=n.forwardRef(l);t.a=r},787:function(e,t,s){"use strict";var a=s(13),n=s(0),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"},i=s(71),l=function(e,t){return n.createElement(i.a,Object(a.a)({},e,{ref:t,icon:c}))},r=n.forwardRef(l);t.a=r},853:function(e,t,s){"use strict";var a=s(0),n=s(50),c=s(2937),i=s(116),l=s(20),r=s(250),o=s(18),d=s(582),b=s(27),u=s(37),_=s(2879);const j=u.e`
  query fetchDocumentTemplate (
    $id: ID, $client_id: ID, $employee_id: ID, $schedule_group_id: ID, $inventory_sale_id: ID,
    $inventory_package_id: ID, $finance_bill_rec_id: ID, $finance_bill_pay_id: ID, $inventory_purchase_id: ID
  ) {
    document_template (id: $id) {
      id name save_on_generation exchange_variables(
        client_id: $client_id, employee_id: $employee_id, schedule_group_id: $schedule_group_id,
        inventory_sale_id: $inventory_sale_id, inventory_package_id: $inventory_package_id,
        finance_bill_rec_id: $finance_bill_rec_id, finance_bill_pay_id: $finance_bill_pay_id,
        inventory_purchase_id: $inventory_purchase_id
      )
    }
  }
`;var m=()=>Object(_.a)(j,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),v=s(232),h=s(19),p=s(82),O=s(22);const f=Object(a.lazy)((()=>Object(v.a)((()=>Promise.all([s.e(13),s.e(157)]).then(s.bind(null,3084)))))),y=Object(a.lazy)((()=>Object(v.a)((()=>Promise.all([s.e(13),s.e(158)]).then(s.bind(null,3085)))))),g=(e,t)=>{const[s,r]=Object(a.useState)(!1),[u,_]=Object(a.useState)(),[j,v]=Object(a.useState)(),[h,g]=Object(a.useState)(),[w,k]=Object(a.useState)(!0),$=Object(l.o)(),C=Object(b.a)((e=>e.current_user.id)),I=Object(b.a)((e=>e.current_user.authentication_token)),D=Object(b.a)((e=>e.current_user.addons.has_upload_image)),S=Object(a.useRef)(null),[M]=c.a.useForm(),{setFieldsValue:H,getFieldsValue:z,resetFields:L}=M,[R,{data:F,loading:V,called:T}]=m();Object(a.useEffect)((()=>{var e;T&&!V&&null!==F&&void 0!==F&&F.document_template&&(H({exchange_variables:null===F||void 0===F?void 0:F.document_template.exchange_variables}),k(null!==(e=F.document_template.save_on_generation)&&void 0!==e&&e))}),[null===F||void 0===F?void 0:F.document_template,V,T]);const N=Object(a.useCallback)((e=>{let{document_template_id:t,...s}=e;R({variables:{id:t,...s}}),r(!0),_(t),g(s.client_id);const a=s.schedule_group_id||s.inventory_sale_id||s.inventory_package_id||s.finance_bill_rec_id;v(a)}),[R]),E=Object(a.useCallback)((()=>{r(!1)}),[]);Object(a.useImperativeHandle)(t,(()=>({close:E,open:N})));const q=Object(a.useCallback)((()=>{$(`/subscription/addons?addon_id=${o.a.ID_UPLOAD_IMAGE}`)}),[$]),P=Object(a.useCallback)((e=>{const t=document.getElementById("generate-pdf-form");if(!t)return;const s=z();t.save_on_generation.value=e,t.exchange_variables.value=s.exchange_variables,t.submit()}),[z]),B=Object(a.useCallback)((()=>{D||!w?P(w):i.c.confirm({content:Object(n.b)("document_templates.upload_activation"),okText:Object(n.b)("verbs.contract"),okType:"primary",cancelText:Object(n.b)("verbs.cancel"),zIndex:1042,onOk:q,onCancel:()=>{k(!1),P(!1)}})}),[q,D,w,P]),A=Object(a.useCallback)((e=>{e||(L(),_(void 0),g(void 0),v(void 0),k(!0))}),[L]);return Object(O.jsxs)(x,{open:s,width:1650,height:"100%",onClose:E,destroyOnClose:!0,afterOpenChange:A,children:[Object(O.jsx)(c.a,{form:M,layout:"vertical",style:{height:"100%"},children:Object(O.jsx)(d.a,{Mobile:y,Desktop:f,title:null===F||void 0===F?void 0:F.document_template.name,loading:V,save_on_generation:w,setSaveOnGeneration:k,close:E,generatePDF:B,editorRef:S})}),Object(O.jsxs)("form",{id:"generate-pdf-form",action:`${p.a.API}/document_templates/generate_document`,method:"post",target:"_blank",children:[Object(O.jsx)("input",{type:"hidden",name:"document_template_id",value:u,readOnly:!0}),Object(O.jsx)("input",{type:"hidden",name:"client_id",value:h,readOnly:!0}),Object(O.jsx)("input",{type:"hidden",name:"class_id",value:j,readOnly:!0}),Object(O.jsx)("input",{type:"hidden",name:"current_user_id",value:C,readOnly:!0}),Object(O.jsx)("input",{type:"hidden",name:"authentication_token",value:I,readOnly:!0}),Object(O.jsx)("input",{type:"hidden",name:"exchange_variables",readOnly:!0}),Object(O.jsx)("input",{type:"hidden",name:"save_on_generation",readOnly:!0})]})]})};g.displayName="GenerateDocumentDrawer";t.a=Object(a.memo)(Object(a.forwardRef)(g));const x=Object(h.d)(r.a).withConfig({componentId:"wb__sc-wueh2s-0"})([".ant-drawer-body{padding-left:0;padding-right:0;background:",";.tox-statusbar__branding{display:none;}}"],(e=>e.theme.is_mobile?"#f8f8f8":"transparent"))},854:function(e,t,s){"use strict";var a=s(13),n=s(0),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M296 250c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm184 144H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm-48 458H208V148h560v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm440-88H728v-36.6c46.3-13.8 80-56.6 80-107.4 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 50.7 33.7 93.6 80 107.4V764H520c-8.8 0-16 7.2-16 16v152c0 8.8 7.2 16 16 16h352c8.8 0 16-7.2 16-16V780c0-8.8-7.2-16-16-16zM646 620c0-27.6 22.4-50 50-50s50 22.4 50 50-22.4 50-50 50-50-22.4-50-50zm180 266H566v-60h260v60z"}}]},name:"audit",theme:"outlined"},i=s(71),l=function(e,t){return n.createElement(i.a,Object(a.a)({},e,{ref:t,icon:c}))},r=n.forwardRef(l);t.a=r}}]);
//# sourceMappingURL=66.463dab4d.chunk.js.map