(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[81],{1159:function(e,t,a){"use strict";var o=a(0),r=a(37),s=a(1850),n=a(116),l=a(50);const c=r.e`
  mutation DestroyGoal($data: DestroyGoalInput!) {
    destroyGoal(input: $data) {
      success errors
    }
  }
`;t.a=()=>{const[e,t]=Object(o.useState)(!1),[a]=Object(s.a)(c);return[Object(o.useCallback)((async e=>{if(0===e.length)return{successes:0,failures:0};t(!0);const o=n.b.loading(`${Object(l.b)("verbs.wait")}...`,0),r=[],s=[],c=e.map((e=>new Promise(((t,o)=>{a({variables:{data:{id:e}}}).then((t=>{let{data:a}=t;const{success:o}=(null===a||void 0===a?void 0:a.destroyGoal)||{};if(!o)return s.push(e);r.push(e)})).catch((()=>{s.push(e)})).then((()=>{t(!0)}))}))));return await Promise.all(c).finally((()=>{o(),t(!1)})),s.length>0&&n.b.error(`${s.length} ${Object(l.b)("phrases.cant_be_deleted",{prefix:Object(l.b)("words.goal",{count:s.length}).toLocaleLowerCase(),count:s.length})}`),r.length>0&&n.b.success(`${r.length} ${Object(l.b)("phrases.deleted_successfully",{prefix:Object(l.b)("words.goal",{count:r.length}).toLocaleLowerCase(),count:r.length})}`),{successes:r.length,failures:s.length}}),[a]),{loading:e}]}},1349:function(e,t,a){"use strict";var o=a(37),r=a(405),s=a(76);const n=o.e`
  query EmployeeGoalsQuery($employee_ids: [ID!], $date: String!, $force_reload: Boolean) {
    all_goals (employee_ids: $employee_ids, date: $date, force_reload: $force_reload) {
      employee { id name small_thumb_url large_thumb_url avatar_blurhash }
      goals {
        id
        employee { id name small_thumb_url large_thumb_url avatar_blurhash }
        value
        value_type
        current_value
        pay_bonus
        bonus_value_cents

        bonification {
          id
        }

        goal_products {
          id
          inventory_product {
            id
            description
            image_url: small_thumb_url
            image_blurhash
            is_service: service
          }
        }
      }
    }
  }
`;t.a=(e,t)=>{let{employee_ids:a,period:o}=e;return Object(r.f)(n,{skip:!t,fetchPolicy:"network-only",variables:{employee_ids:a,date:o.format("YYYY-MM-DD")},notifyOnNetworkStatusChange:!0,onError:e=>{s.a.captureException(e),console.log(e)}})}},1650:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var o=a(444),r=a(53);const s={period:a.n(r)()(),employee_ids:[],goals:[]};t.b=(e,t)=>{switch(t.type){case"reset_goals":return console.debug("[GoalsDrawer Reducer] Resetando meta"),s;case"set_goals":return{...e,...t.payload};case"set_employee_ids":return{...e,employee_ids:t.payload};case"set_period":return{...e,period:t.payload};case"add_goal":return{...e,goals:[...e.goals,t.payload]};case"update_goal":return l(e,t.payload);case"remove_goal":return n(e,t.payload);default:return e}};const n=(e,t)=>{const a=[...e.goals],r=a.findIndex((e=>e.id===t));if(-1===r)return e;const s=a[r];return Object(o.a)(s.id)?a.splice(r,1):a[r]._destroy=!0,{...e,goals:a}},l=(e,t)=>{const a=[...e.goals],o=a.findIndex((e=>e.id===t.id));return-1===o?e:(a[o]=t,{...e,goals:a})}},2954:function(e,t,a){"use strict";a.r(t),a.d(t,"INITIAL_FILTERS",(function(){return re}));var o=a(0),r=a(250),s=a(18),n=a(767),l=a(585),c=a(50),i=a(116),d=a(879),b=a(447),u=a(444);Object(b.a)();const p=e=>{let{goal_products:t,inventory_products:a}=e;const o=a.map((e=>e.id));return[...o.reduce(((e,a)=>{const o=t.find((e=>e.inventory_product.id===a));return o?[...e,{id:o.id,inventory_product_id:o.inventory_product.id,_destroy:!1}]:[...e,{id:void 0,inventory_product_id:a}]}),[]),...t.reduce(((e,t)=>o.includes(t.inventory_product.id)?e:[...e,{id:t.id,inventory_product_id:t.inventory_product.id,_destroy:!0}]),[])]};var _=a(53),h=a.n(_),m=a(1650),j=a(1159),g=a(27),O=a(339),y=a(37),f=a(1850);const v=y.e`
  mutation saveGoalMutation($data: SaveGoalInput!) {
    saveGoal(input: $data) {
      success errors
    }
  }
`;var w=()=>{const[e,{loading:t}]=Object(f.a)(v);return[async t=>{const a=[];let o=0;const r=i.b.loading(`${Object(c.b)("verbs.wait")}...`,0),s=t.map((t=>new Promise((async(r,s)=>{e({variables:{data:t}}).then((e=>{let{data:t}=e;const{success:r,errors:s=[]}=(null===t||void 0===t?void 0:t.saveGoal)||{};if(!r)return a.push(...s);o++})).catch((()=>{const e=Object(c.b)("phrases.generic_save_error_message");a.push(e)})).then((()=>{r(!0)}))}))));return await Promise.all(s).then((()=>{i.b.destroy(),a.length>0&&i.b.error(`${a.length} ${Object(c.b)("phrases.cant_be_saved",{prefix:Object(c.b)("words.goal",{count:a.length}).toLocaleLowerCase(),count:a.length,context:"female"})}`),o>0&&i.b.success(`${o} ${Object(c.b)("phrases.saved_successfully",{prefix:Object(c.b)("words.goal",{count:o}).toLocaleLowerCase(),count:o,context:"female"})}`)})).finally((()=>{r()})),{success:!0}},t]},x=a(232),k=a(582),C=a(22);const $=Object(o.lazy)((()=>Object(x.a)((()=>a.e(173).then(a.bind(null,2997)))))),M=Object(o.lazy)((()=>Object(x.a)((()=>a.e(174).then(a.bind(null,2987)))))),Y=()=>Object(C.jsx)(k.a,{Desktop:$,Mobile:M});Y.displayName="GoalFormList";var D=Y,R=a(2879);const I=y.e`
  query GoalsQuery($employee_id: ID!, $date: String!) {
    goals(employee_id: $employee_id, date: $date) {
      id
      employee_id
      pay_bonus
      bonus_value_cents

      goal_products {
        id
        inventory_product {
          id
          description
          image_url
        }
      }

      value
      value_type
    }
  }
`;var S=e=>{const t=Object(o.useCallback)((t=>{let{goals:a=[]}=t;if(0===a.length)return;const o=a.map((e=>{const t=e.goal_products.map((e=>e.inventory_product));return{id:e.id,employee_id:e.employee_id,goal_products:e.goal_products,inventory_products:t,value_type:e.value_type,value:e.value,pay_bonus:e.pay_bonus,bonus_value_cents:e.bonus_value_cents,_destroy:!1}})),r={employee_ids:[a[0].employee_id],goals:o};e({type:"set_goals",payload:r})}),[e]);return Object(R.a)(I,{onCompleted:t,fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0})},G=a(2937),L=a(2883),N=a(2934),q=a(614);const z=()=>{const e=Object(g.a)((e=>e.is_mobile)),t=Object(d.b)((e=>e.employee_disabled)),a=Object(d.b)((e=>e.period_disabled)),s=Object(d.b)((e=>e.state.period)),n=Object(d.b)((e=>e.state.employee_ids)),l=Object(d.b)((e=>e.dispatch)),i=Object(o.useCallback)((e=>{l({type:"set_employee_ids",payload:e})}),[l]),b=Object(o.useCallback)((e=>{l({type:"set_period",payload:e})}),[l]);return Object(C.jsx)(G.a,{layout:"vertical",children:Object(C.jsxs)(r.g,{$wrap:!0,$isRelative:!0,gutter:[8,0],children:[Object(C.jsx)(L.a,{xs:24,md:16,children:Object(C.jsx)(G.a.Item,{label:Object(c.b)("words.employee",{count:2}),rules:[{required:!0,message:Object(c.b)("phrases.required_field")}],children:Object(C.jsx)(q.a,{size:e?"large":void 0,placeholder:Object(c.b)("goals.inform_employee",{count:2}),mode:"multiple",disabled:t,showCreateButton:!1,allowClear:!0,value:n,onChange:i})})}),Object(C.jsx)(L.a,{xs:24,md:8,children:Object(C.jsx)(G.a.Item,{label:Object(c.b)("words.period"),rules:[{required:!0,message:Object(c.b)("phrases.required_field")}],children:Object(C.jsx)(N.a,{size:e?"large":void 0,format:"MMMM/YYYY",picker:"month",inputReadOnly:!0,disabled:a,style:{width:"100%"},allowClear:!1,value:s,onChange:b})})})]})})};z.displayName="HeaderForm";var F=z,E=a(581);const P=(e,t)=>{let{afterSave:a}=e;const[s,n]=Object(o.useState)(!1),[l,b]=Object(o.useState)(!1),[_,y]=Object(o.useState)(!1),[f,v]=Object(o.useReducer)(m.b,m.a),x=Object(g.a)((e=>e.current_user.permissions)),k=Object(g.a)((e=>e.current_user.employee_id)),$=Object(g.a)((e=>e.is_mobile)),[M,{loading:Y,refetch:R}]=S(v),[I,G]=w(),[L,{loading:N}]=Object(j.a)();Object(o.useEffect)((()=>{s&&(x.can_access_all_goal||(b(!0),v({type:"set_employee_ids",payload:[k]})))}),[x.can_access_all_goal,k,s]);const q=Object(o.useCallback)((()=>{n(!1)}),[]),z=Object(o.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h()(),t=arguments.length>1?arguments[1]:void 0;t&&(b(!0),y(!0),M({variables:{employee_id:t,date:e.format("YYYY-MM-DD")}}),v({type:"set_employee_ids",payload:[t]})),v({type:"set_period",payload:e}),n(!0)}),[M]);Object(o.useImperativeHandle)(t,(()=>({open:z,close:q})));const P=Object(o.useCallback)((async()=>{const{goals:e,employee_ids:t,period:o}=f;if(0===e.length)return i.b.warning(Object(c.b)("goals.inform_a_valid_goal"));if(e.some((e=>e.pay_bonus&&e.bonus_value_cents<=0)))return void i.b.warning(Object(c.b)("goals.bonus_value_greater_than_zero"));const r=(e=>e.reduce(((e,t)=>t._destroy?[...e,t.id]:e),[]))(e),s=((e,t,a)=>t.map((t=>e.filter((e=>!e._destroy)).map((e=>{const{_destroy:o,inventory_products:r,goal_products:s,...n}=e,l=Object(u.a)(n.id);return{...n,id:l?void 0:n.id,goal_products_attributes:p(e),period:a.format("YYYY-MM-DD"),employee_id:t}})))).flatMap((e=>e)))(e,t,o),{successes:n}=await L(r),{success:l}=await I(s);(l||n>0)&&(q(),null===a||void 0===a||a())}),[a,q,L,I,f]),H=Object(o.useCallback)((e=>{e||(v({type:"reset_goals"}),b(!1),y(!1))}),[]),T=Object(o.useMemo)((()=>({loading:Y,save_loading:G,destroy_loading:N,employee_disabled:l,period_disabled:_,state:f,dispatch:v,submit:P,refetch:R})),[N,l,Y,_,R,G,f,P]);return Object(C.jsx)(r.a,{closable:!0,push:!1,title:Object(c.b)("words.goal",{count:2}),height:"100%",destroyOnClose:!0,width:900,afterOpenChange:H,zIndex:1e3,onClose:q,open:s,placement:$?"bottom":"right",footer:Object(C.jsx)(E.a,{close:q,submit:P,loading:G||N,disabled:Y||G||N}),children:Object(C.jsxs)(d.a.Provider,{value:T,children:[Object(C.jsx)(O.a,{loading:Y}),Object(C.jsx)(F,{}),Object(C.jsx)(D,{})]})})};P.displayName="GoalsDrawer";var H=Object(o.memo)(Object(o.forwardRef)(P)),T=a(610);const A=e=>{let{show_filters:t,setFilters:a}=e;const o=Object(n.b)((e=>e.filters)),{period:s,employee_ids:l}=o,i=Object(g.a)((e=>e.current_user.permissions)),d=e=>{a((t=>({...t,...e})))};return Object(C.jsxs)(T.a,{$visible:t,style:{overflow:t?"initial":"hidden"},children:[Object(C.jsxs)(T.b,{children:[Object(C.jsx)(r.g,{$alignCenter:!0,justify:"space-between",$bottom:15,children:Object(C.jsx)(r.h,{$semibold:!0,children:Object(c.b)("words.period")})}),Object(C.jsx)(r.g,{$column:!0,children:Object(C.jsx)(N.a,{format:"MMMM/YYYY",picker:"month",value:s,style:{width:"100%"},allowClear:!1,onChange:e=>{e&&d({period:e})}})})]}),Object(C.jsxs)(T.b,{children:[Object(C.jsx)(r.g,{$alignCenter:!0,$bottom:15,children:Object(C.jsx)(r.h,{$semibold:!0,children:Object(c.b)("words.employee",{count:2})})}),Object(C.jsx)(q.a,{value:l,mode:"multiple",placeholder:Object(c.b)("words.all"),disabled:!i.can_access_all_goal,style:{width:"100%"},allowClear:!0,onChange:e=>{d({employee_ids:e})}})]})]})};A.displayName="GoalFiltersDesktop";var B=Object(o.memo)(A),J=a(1349),Q=a(593);const K=Object(o.lazy)((()=>Object(x.a)((()=>a.e(89).then(a.bind(null,2985)))))),U=Object(o.lazy)((()=>Object(x.a)((()=>a.e(78).then(a.bind(null,2994)))))),V=e=>Object(C.jsx)(k.a,{Desktop:K,Mobile:U,...e});V.displayName="TableData";var W=Object(o.memo)(V),X=a(586),Z=a(19);const ee=Object(o.lazy)((()=>Object(x.a)((()=>a.e(115).then(a.bind(null,2915)))))),te=Object(o.lazy)((()=>Object(x.a)((()=>a.e(58).then(a.bind(null,3007)))))),ae=e=>Object(C.jsx)(k.a,{Desktop:ee,Mobile:te,...e});ae.displayName="Header";var oe=ae;const re={period:h()().startOf("month"),employee_ids:[]},se=()=>{const[e,t]=Object(o.useState)(!1),a=Object(o.useRef)(null),c=Object(o.useRef)(null),i=Object(o.useRef)(null),d=Object(g.a)((e=>{var t;const a=e.current_user.features,o=e.current_user.addons,r=!(null===(t=e.current_user.salon.subscription)||void 0===t||!t.is_trial),s=e.is_webook;return a.has_goals||o.has_goals||r||s}));Object(Q.a)({feature_keys:["has_goals"],addon_keys:["has_goals"],search:s.a.ID_GOALS});const b=Object(g.a)((e=>e.current_user.employee_id)),u=Object(g.a)((e=>e.current_user.permissions)),[p,_]=Object(o.useState)((()=>({...re,employee_ids:u.can_access_all_goal?[]:[String(b)]}))),{data:{all_goals:h=[]}={},loading:m,error:j,refetch:O}=Object(J.a)(p,d),y=Object(o.useCallback)((()=>{O({...p,date:p.period.format("YYYY-MM-DD"),force_reload:!0})}),[p,O]),f=Object(o.useMemo)((()=>({filters:p,goalDrawerRef:c,goalsListMobileDrawerRef:i,forceRefetch:y})),[p,y]);return Object(C.jsx)(n.a.Provider,{value:f,children:Object(C.jsxs)(l.b,{children:[Object(C.jsx)(oe,{show_filters:e,setShowFilters:t,filtersMobileRef:a,setFilters:_,forceRefetch:y}),Object(C.jsxs)(ne,{$pageFull:!0,has_permission:u.can_access_all_goal||u.can_access_goal,children:[Object(C.jsx)(B,{setFilters:_,show_filters:e}),Object(C.jsxs)(r.g,{children:[Object(C.jsx)(X.a,{visible:!!j,small:!0}),Object(C.jsx)(W,{data:h,loading:m})]})]}),Object(C.jsx)(H,{ref:c,afterSave:()=>{var e;null===(e=i.current)||void 0===e||e.close(),y()}})]})})};se.displayName="Goals";t.default=se;const ne=Object(Z.d)(l.c).withConfig({componentId:"wb__sc-1371o5m-0"})(["display:flex;justify-content:center;padding-bottom:","px;"],(e=>e.theme.is_mobile?e.theme.sidebar_mobile_bottom_margin:0))},609:function(e,t,a){"use strict";var o=a(0),r=a(50),s=a(159),n=a(53),l=a.n(n),c=a(19),i=a(22);const d=e=>{let{handleChangeRange:t}=e;return Object(i.jsx)(b,{children:u.map((e=>{let{label:a,value:o}=e;return Object(i.jsx)(s.a,{type:"primary",onClick:()=>t(o),children:a},a)}))})};d.displayName="ExtraRangeComponent",t.a=Object(o.memo)(d);const b=c.d.div.withConfig({componentId:"wb__sc-hoi2yi-0"})(["display:flex;flex-wrap:wrap;justify-content:space-between;padding-top:8px;.ant-btn{cursor:pointer;width:49%;text-align:center;margin-bottom:8px;margin-right:0;}"]),u=[{label:Object(r.b)("words.today"),value:[l()(),l()()]},{label:Object(r.b)("date.last_week"),value:[l()().startOf("week").subtract(1,"week"),l()().endOf("week").subtract(1,"week")]},{label:Object(r.b)("date.last_month"),value:[l()().subtract(1,"month").startOf("month"),l()().subtract(1,"month").endOf("month")]},{label:Object(r.b)("date.current_month"),value:[l()().startOf("month"),l()().endOf("month")]},{label:Object(r.b)("date.six_months_ago"),value:[l()().subtract(6,"month"),l()()]},{label:Object(r.b)("date.one_year_ago"),value:[l()().subtract(12,"month"),l()()]}]},610:function(e,t,a){"use strict";a.d(t,"d",(function(){return p})),a.d(t,"b",(function(){return _})),a.d(t,"c",(function(){return h})),a.d(t,"a",(function(){return m}));var o=a(19),r=a(0),s=a(2934),n=a(609),l=a(22);const c=(e,t)=>{let{onRangeChange:a,...o}=e;const[c,i]=Object(r.useState)(!1),b=Object(r.useCallback)((e=>{a(e)}),[a]);return Object(l.jsx)(s.a,{ref:t,showNow:!1,renderExtraFooter:()=>Object(l.jsx)(d,{children:Object(l.jsx)(n.a,{handleChangeRange:b})}),...o,open:c,onOpenChange:i})};c.displayName="SimpleRangePicker";var i=Object(r.memo)(Object(r.forwardRef)(c));const d=o.d.div.withConfig({componentId:"wb__sc-13lwjt0-0"})(["width:265px;"]),b={true:!0,false:!1,all:null,none:null},u=["start_date","end_date","birthday_start_date","birthday_end_date","start_date_open","start_date_close","end_date_open","end_date_close"],p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={},a={};return Object.entries(e).forEach((e=>{let[a,o]=e;o in b&&(t[a]=b[o])})),Object.entries(e).forEach((e=>{let[t,o]=e;u.includes(t)&&(a[t]=null===o||void 0===o?void 0:o.format("YYYY-MM-DD"))})),{...e,...t,...a}},_=o.d.div.withConfig({componentId:"wb__sc-gq8qm5-0"})(["display:flex;flex-direction:column;background-color:",";border-radius:16px;box-shadow:0 0 10px 5px #f3f3f3;padding:15px;border:1px solid rgba(0 0 0 / 3%);transition:box-shadow .1s;margin-bottom:5px;.ant-checkbox-wrapper + .ant-checkbox-wrapper{overflow:hidden;margin-left:0;width:100%;:not(:first-child){overflow:hidden;white-space:nowrap;text-overflow:ellipsis;word-break:keep-all;}}.ant-radio-wrapper{margin-right:0;}.ant-checkbox-group-item{margin-right:0;}.ant-calendar-picker-clear{background:transparent;color:",";}.ant-calendar-picker-input{border-top:none;border-left:none;border-right:none;border-radius:0;margin-top:5px;background:transparent;"," &:focus{box-shadow:none;}}.anticon-calendar{color:rgba(0,0,0,.2);}",""],(e=>e.theme.colors.white),(e=>e.theme.dark&&e.theme.dark_white),(e=>e.theme.dark&&`\n      border-color: ${e.theme.dark_secondary};\n      color: ${e.theme.dark_white};\n    `),(e=>e.tags&&Object(o.c)(["display:flex;flex-wrap:wrap;.ant-tag{margin:0 4px 4px 0;cursor:pointer;}"]))),h=Object(o.d)(i).withConfig({componentId:"wb__sc-gq8qm5-1"})(["width:100%;border-top:none;border-left:none;border-right:none;border-radius:0 !important;margin-top:5px;background:transparent;&.ant-picker-focused{box-shadow:none;}"]),m=o.d.div.withConfig({componentId:"wb__sc-gq8qm5-2"})(["min-width:0;width:0;z-index:210;text-overflow:ellipsis;white-space:nowrap;position:sticky;top:calc(","px + 10px);overflow:hidden;max-height:calc(100vh - 60px);align-self:flex-start;transition:width .2s;",""],(e=>e.theme.menu_top_height),(e=>!!e.$visible&&Object(o.c)(["min-width:230px;width:230px;padding-right:7px;overflow-y:auto;overflow-x:hidden;"])))},767:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var o=a(640),r=a(53),s=a.n(r);const n=Object(o.a)({filters:{period:s()().startOf("month"),employee_ids:[]},goalDrawerRef:{current:{open:(e,t)=>{},close:()=>{}}},goalsListMobileDrawerRef:{current:{open:e=>{},close:()=>{}}},forceRefetch:()=>{}});t.b=e=>Object(o.b)(n,e)},879:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var o=a(640),r=a(1650);const s=Object(o.a)({loading:!1,save_loading:!1,destroy_loading:!1,employee_disabled:!1,period_disabled:!1,state:r.a,dispatch:e=>{},submit:()=>{}});t.b=e=>Object(o.b)(s,e)}}]);
//# sourceMappingURL=81.cfee4347.chunk.js.map