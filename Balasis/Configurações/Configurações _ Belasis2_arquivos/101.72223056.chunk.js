(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[101],{2944:function(e,t,a){"use strict";a.r(t);var o=a(0),r=a(50),s=a(116),n=a(18),l=a(2854),i=a(37);const c=i.e`
  query PromotionList (
    $page: Int, $results: Int, $search_query: String, $sort_field: String, $sort_order: String, $start_date: String,
    $end_date: String, $actives: Boolean, $weekdays: [String]
  ) {
    all_promotions (
      page: $page, results: $results, search_query: $search_query, sort_field: $sort_field, sort_order: $sort_order,
      start_date: $start_date, end_date: $end_date, actives: $actives, weekdays: $weekdays
    ) {
      all {
        id
        name
        start_date
        end_date
        wday_0
        wday_1
        wday_2
        wday_3
        wday_4
        wday_5
        wday_6

        promotion_items {
          id
          value_type
          value
          inventory_product {
            id
            description
          }
        }
      }

      total_count
    }
  }
`,d=i.e`
  query PromotionIdsList {
    all_promotions {
      all {
        id
      }
    },
  }
`;var b=a(627),u=a(2937),_=a(250),m=a(27),p=a(339),j=a(1850),h=a(76);const v=i.e`
  mutation SavePromotion ($data: SavePromotionInput!) {
    savePromotion (input: $data) {
      success
      errors
    }
  }
`;var O=()=>{const[e,{loading:t}]=Object(j.a)(v);return[async t=>{try{const{data:a}=await e({variables:{data:t}}),{success:o=!1,errors:r=[]}=(null===a||void 0===a?void 0:a.savePromotion)||{};return null===r||void 0===r||r.forEach((e=>s.b.error(e))),{success:o}}catch(a){return h.a.captureException(a),s.b.error(Object(r.b)("phrases.generic_save_error_message")),console.error(a),{success:!1}}},{loading:t}]},y=a(2879),f=a(188);const g=i.e`
  query FetchPromotion ($id: ID) {
    promotion (id: $id) {
      id end_date name start_date wday_0 wday_1 wday_2 wday_3 wday_4 wday_5 wday_6

      promotion_items {
        id value_type value
        inventory_product {
          ...InventoryProductsAttributes
        }
      }
    }
  }

  ${f.b}
`;var w=e=>Object(y.a)(g,{fetchPolicy:"network-only",onCompleted:t=>{const{promotion:a}=t;e(a)},onError:e=>{h.a.captureException(e),console.log({error:e})}}),x=a(2824),k=a(543),C=a(2883),S=a(2934),$=a(1438),I=a(1814),P=a(538),M=a(1256),q=a(2838),N=a(579),F=a(622),D=a(19),R=a(693),V=a(22);const L=e=>{let{field:t,last_item:a,add:s,destroy:n,getFieldValue:l,setFieldsValue:i}=e;const c=Object(m.a)((e=>e.is_mobile)),d=Object(o.useCallback)((e=>{const a=l("promotion_items_attributes"),o=a[t.name],r=e.price_cents/100;"percentage"===o.value_type||o.value<=r||(a[t.name]={...o,value:r},i({promotion_items_attributes:a}))}),[t.name,l,i]),b=Object(o.useCallback)((e=>{a&&s({is_service:!0}),d(e)}),[s,a,d]),_=Object(o.useCallback)(((e,a)=>{const o=l("promotion_items_attributes"),r=o[t.name];"percentage"===e&&r.value>100&&(o[t.name]={...r,value:100},i({promotion_items_attributes:o})),"cents"===e&&a&&d(a)}),[t.name,l,i,d]);return Object(V.jsxs)(T,{gutter:8,children:[Object(V.jsx)(u.a.Item,{noStyle:!0,name:[t.name,"id"],fieldKey:[t.key,"id"],children:Object(V.jsx)(x.a,{type:"hidden"})}),Object(V.jsx)(u.a.Item,{noStyle:!0,name:[t.name,"_destroy"],fieldKey:[t.key,"_destroy"],children:Object(V.jsx)(x.a,{type:"hidden"})}),Object(V.jsx)(C.a,{xs:24,sm:16,children:Object(V.jsx)(u.a.Item,{dependencies:[t.name,"is_service"],label:Object(r.b)("words.item"),children:e=>{let{getFieldValue:a,setFieldsValue:o}=e;const r=a(["promotion_items_attributes",t.name,"is_service"]);return Object(V.jsxs)(Y,{block:!0,children:[Object(V.jsx)(u.a.Item,{name:[t.name,"is_service"],noStyle:!0,children:Object(V.jsx)(R.a,{onChange:e=>o({is_service:e?"true":"false"})})}),Object(V.jsx)(u.a.Item,{noStyle:!0,name:[t.name,"inventory_product"],getValueFromEvent:(e,t)=>null===t||void 0===t?void 0:t.item,getValueProps:e=>({value:null===e||void 0===e?void 0:e.id,item:e}),children:Object(V.jsx)(F.a,{is_service:r,style:{width:"100%"},onChange:(e,t)=>b(t.item),size:c?"large":"middle"})})]})}})}),Object(V.jsx)(C.a,{xs:24,sm:8,children:Object(V.jsx)(u.a.Item,{label:Object(r.b)("words.discount"),shouldUpdate:(e,a)=>{var o,r;const s=e.promotion_items_attributes[t.name],n=a.promotion_items_attributes[t.name];return(null===s||void 0===s?void 0:s.value_type)!==(null===n||void 0===n?void 0:n.value_type)||(null===s||void 0===s||null===(o=s.inventory_product)||void 0===o?void 0:o.id)!==(null===n||void 0===n||null===(r=n.inventory_product)||void 0===r?void 0:r.id)},children:e=>{let{getFieldValue:a}=e;const o=a(["promotion_items_attributes",t.name,"value_type"]),r=a(["promotion_items_attributes",t.name,"inventory_product"]),s="percentage"===o?100:(null===r||void 0===r?void 0:r.price_cents)/100;return Object(V.jsxs)(P.a.Compact,{block:!0,children:[Object(V.jsx)(u.a.Item,{name:[t.name,"value_type"],initialValue:"cents",noStyle:!0,children:Object(V.jsx)(M.a,{style:{width:70},options:[{label:Object(N.h)(),value:"cents"},{label:"%",value:"percentage"}],onChange:e=>_(e,r),size:c?"large":"middle"})}),Object(V.jsx)(u.a.Item,{name:[t.name,"value"],initialValue:0,noStyle:!0,children:Object(V.jsx)(q.a,{min:0,max:s,parser:N.t,formatter:e=>Object(N.s)(e),className:"hide-number-button",style:{width:"calc(100% - 70px)"},size:c?"large":"middle"})})]})}})}),!a&&!c&&Object(V.jsx)(E,{className:"color-red",onClick:()=>n(t.name)})]})};L.displayName="PromotionItem";var z=L;const E=Object(D.d)(l.a).withConfig({componentId:"wb__sc-ojefvh-0"})(["position:absolute;right:0;top:40px;font-size:18rem;"]),T=Object(D.d)(k.a).withConfig({componentId:"wb__sc-ojefvh-1"})(["width:100%;position:relative;padding-right:20px;.ant-form-item{margin-bottom:8px;.ant-form-item-explain{display:none;}}@media (max-width:768px){padding:10px;background-color:",";user-select:none;.swipeable-list-item__content{border-radius:5px;}}"],(e=>e.theme.colors.white)),Y=Object(D.d)(P.a.Compact).withConfig({componentId:"wb__sc-ojefvh-2"})(["& > div:last-child{width:calc(100% - 32px) !important;}"]);var A=a(662),K=a(53),H=a.n(K);const B=[0,1,2,3,4,5,6].map((e=>{const t=H()().day(e).format("dddd");return t.charAt(0).toUpperCase()+t.slice(1)})),J=e=>{let{setFieldsValue:t,getFieldValue:a}=e;const o=Object(m.a)((e=>e.is_mobile));return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(u.a.Item,{name:"id",noStyle:!0,children:Object(V.jsx)(x.a,{type:"hidden"})}),Object(V.jsx)(k.a,{gutter:8,children:Object(V.jsx)(C.a,{span:24,children:Object(V.jsx)(u.a.Item,{name:"name",label:Object(r.b)("words.name"),rules:[{required:!0,message:Object(r.b)("phrases.required_field")}],children:Object(V.jsx)(x.a,{placeholder:Object(r.b)("input.inform_the_name"),size:o?"large":"middle"})})})}),Object(V.jsxs)(k.a,{gutter:8,children:[Object(V.jsx)(C.a,{span:12,children:Object(V.jsx)(u.a.Item,{name:"start_date",label:Object(r.b)("date.start_date"),children:Object(V.jsx)(S.a,{format:"L",style:{width:"100%"},allowClear:!0,size:o?"large":"middle"})})}),Object(V.jsx)(C.a,{span:12,children:Object(V.jsx)(u.a.Item,{name:"end_date",label:Object(r.b)("date.end_date"),children:Object(V.jsx)(S.a,{format:"L",style:{width:"100%"},allowClear:!0,size:o?"large":"middle"})})})]}),Object(V.jsx)($.a,{type:"horizontal",orientation:"left",children:Object(r.b)("promotions.weekdays")}),Object(V.jsx)(k.a,{gutter:8,children:B.map(((e,t)=>Object(V.jsx)(C.a,{children:Object(V.jsx)(u.a.Item,{name:`wday_${t}`,valuePropName:"checked",children:Object(V.jsx)(I.a,{children:e})})},e)))}),Object(V.jsx)($.a,{type:"horizontal",orientation:"left",children:Object(r.b)("words.item",{count:2})}),Object(V.jsx)(A.a,{name:"promotion_items_attributes",setFieldsValue:t,getFieldValue:a,Item:z})]})};var U=Object(o.memo)(J),W=a(581);const G=(e,t)=>{let{afterSave:a}=e;const n=Object(m.a)((e=>e.is_mobile)),[l,i]=Object(o.useState)(!1),[c]=u.a.useForm(),{submit:d,setFieldsValue:b,getFieldValue:j,resetFields:h}=c,v=Object(o.useCallback)((e=>{let{promotion_items:t,start_date:a,end_date:o,...r}=e;const s=t.map((e=>({id:e.id,is_service:e.inventory_product.is_service,inventory_product:e.inventory_product,value_type:e.value_type,value:e.value}))),n={...r,start_date:a?H()(a):void 0,end_date:o?H()(o):void 0,promotion_items_attributes:[...s,{is_service:!0,value_type:"cents"}]};b(n)}),[b]),[y,{loading:f}]=w(v),[g,{loading:x}]=O(),k=e=>{i(!0),e&&y({variables:{id:e}})},C=Object(o.useCallback)((()=>{i(!1)}),[]);Object(o.useImperativeHandle)(t,(()=>({close:C,open:k})));const S=Object(o.useCallback)((async e=>{let{start_date:t,end_date:o,...n}=e;const l=n.promotion_items_attributes.filter((e=>!!e.inventory_product)).map((e=>{let{is_service:t,inventory_product:a,...o}=e;return{...o,inventory_product_id:a.id}})),i={...n,start_date:t?t.format("YYYY-MM-DD"):null,end_date:o?o.format("YYYY-MM-DD"):null,promotion_items_attributes:l},{success:c}=await g(i);c&&(s.b.success(Object(r.b)("phrases.saved_successfully",{prefix:Object(r.b)("words.promotion"),context:"female"})),C(),null===a||void 0===a||a())}),[a,C,g]),$=Object(o.useCallback)((e=>{e||h()}),[h]);return Object(V.jsxs)(_.a,{open:l,title:Object(r.b)("words.promotion"),placement:n?"bottom":"right",height:"100%",onClose:C,width:620,closable:!0,destroyOnClose:!0,afterOpenChange:$,footer:Object(V.jsx)(W.a,{close:C,submit:d,loading:x}),push:!1,children:[Object(V.jsx)(p.a,{loading:f}),Object(V.jsx)(u.a,{form:c,layout:"vertical",onFinish:S,initialValues:{promotion_items_attributes:[{is_service:!0}]},children:Object(V.jsx)(U,{setFieldsValue:b,getFieldValue:j})})]})};G.displayName="PromotionDrawer";var Q=Object(o.forwardRef)(G),X=a(667),Z=a(593),ee=a(547);const te=e=>{if(!e)return!1;const t=H()(),a=H()(e.start_date).isSameOrBefore(t,"day"),o=H()(e.end_date).isSameOrAfter(t,"day");return!(e.start_date&&!a||e.end_date&&!o)};var ae=a(583);const oe=e=>{const{item:t}=e,a=te(t);return Object(V.jsxs)("div",{style:{width:"100%"},children:[Object(V.jsxs)(_.g,{style:{overflow:"hidden",flexGrow:1},justify:"space-between",children:[Object(V.jsx)(ae.b,{width:22,$block:!0,$color:"primary",$bold:!0,$right:3,$textEllipsis:!0,$isFlex:!0,children:null===t||void 0===t?void 0:t.name}),Object(V.jsx)(ae.b,{width:8,children:a?Object(V.jsx)(ee.a,{color:"green",children:Object(r.b)("words.active",{context:"female"})}):Object(V.jsx)(ee.a,{color:"red",children:Object(r.b)("words.inactive",{context:"female"})})})]}),Object(V.jsxs)(_.g,{$fullWidth:!0,justify:"space-between",children:[Object(V.jsx)(ae.b,{width:8,$block:!0,$color:"gray_1",$top:5,$right:5,$textEllipsis:!0,children:null!==t&&void 0!==t&&t.start_date?H()(null===t||void 0===t?void 0:t.start_date).format("L"):Object(r.b)("promotions.no_start_date")}),Object(V.jsx)(ae.b,{width:8,$block:!0,$color:"gray_1",$top:5,$right:5,$textEllipsis:!0,children:null!==t&&void 0!==t&&t.end_date?H()(null===t||void 0===t?void 0:t.end_date).format("L"):Object(r.b)("promotions.no_end_date")})]})]})};oe.displayName="PromotionItemMobile";var re=Object(o.memo)(oe);var se=()=>Object(o.useMemo)((()=>[{label:Object(r.b)("words.status"),name:"actives",double_checkbox:{true:Object(r.b)("words.active",{count:2,context:"female"}),false:Object(r.b)("words.inactive",{count:2,context:"female"})}},{label:Object(r.b)("words.period"),name:"dates",rangepicker:{start_date_name:"start_date",end_date_name:"end_date"}},{label:Object(r.b)("promotions.weekdays"),name:"weekdays",checkbox_options:[1,2,3,4,5,6,0].map((e=>({label:H()().day(e).format("dddd"),value:`wday_${e}`}))),checkbox_disabled:!0}]),[]);const ne=i.e`
  mutation PromotionListDestroyPromotion($data: DestroyPromotionInput!) {
    destroyPromotion(input: $data) {
      success errors
    }
  }
`;var le=()=>{const[e,t]=Object(o.useState)(!1),[a]=Object(j.a)(ne);return{destroyPromotion:Object(o.useCallback)((async(e,o)=>{t(!0);const n=s.b.loading(`${Object(r.b)("verbs.wait")}...`,0),l=[],i=[],c=e.map((e=>new Promise(((t,o)=>{a({variables:{data:{id:e}}}).then((t=>{let{data:{destroyPromotion:{success:a}}}=t;if(!a)return i.push(e);l.push(e)})).catch((()=>{i.push(e)})).then((()=>{t(!0)}))}))));await Promise.all(c).then((()=>{t(!1),n(),null===o||void 0===o||o(l.length),l.length>0&&s.b.success(`${l.length} ${Object(r.b)("phrases.deleted_successfully",{prefix:Object(r.b)("words.promotion",{count:l.length}).toLocaleLowerCase(),count:l.length,context:"female"})}`),i.length>0&&s.b.error(`${i.length} ${Object(r.b)("phrases.cant_be_deleted",{prefix:Object(r.b)("words.promotion",{count:i.length}).toLocaleLowerCase(),count:i.length,context:"female"})}`)}))}),[a]),is_destroying:e}},ie=a(852),ce=a(616),de=a(3034);const be=[0,1,2,3,4,5,6].map((e=>H()().day(e).format("dddd")));var ue=e=>{let{openPromotionDrawer:t,handleDestroyPromotion:a}=e;const n=Object(m.a)((e=>e.current_user.permissions)),i=Object(o.useCallback)((e=>{n.can_destroy_promotion?s.c.confirm({centered:!0,className:"webook-modal",title:Object(r.b)("words.attention"),maskClosable:!0,content:Object(r.b)("phrases.confirm_delete",{model:Object(r.b)("words.promotion").toLocaleLowerCase(),context:"female"}),okText:Object(r.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(r.b)("verbs.cancel"),onOk:()=>a([e])}):s.b.warning(Object(r.b)("phrases.no_permission_to_do_this"))}),[a,n.can_destroy_promotion]);return Object(o.useMemo)((()=>[{title:Object(r.b)("words.name"),key:"name",dataIndex:"name",align:"left",className:"table-sort",sorter:!0,default_visible:!0,always_visible:!0,ellipsis:!0,render:(e,a)=>Object(V.jsx)(_.i,{style:{maxWidth:"100%"},title:e,className:"link",onClick:()=>{null!==n&&void 0!==n&&n.can_edit_promotion?t(a.id):s.b.warning(Object(r.b)("phrases.no_permission_to_do_this"))},children:e})},{title:Object(r.b)("date.start_date"),key:"start_date",dataIndex:"start_date",sorter:!0,defaultSortOrder:"descend",default_visible:!0,width:110,render:e=>e?H()(e).format("L"):void 0},{title:Object(r.b)("date.end_date"),key:"end_date",dataIndex:"end_date",sorter:!0,default_visible:!0,width:110,render:e=>e?H()(e).format("L"):void 0},{title:Object(r.b)("promotions.weekdays"),key:"finished",dataIndex:"finished",default_visible:!0,ellipsis:!0,width:"20%",render:(e,t)=>{const{wday_0:a,wday_1:o,wday_2:s,wday_3:n,wday_4:l,wday_5:i,wday_6:c}=t;return[a,o,s,n,l,i,c].every(Boolean)?Object(r.b)("promotions.everyday"):!a||!c||o||s||n||l||i?o&&s&&n&&l&&i&&!a&&!c?Object(r.b)("promotions.weekday"):[0,1,2,3,4,5,6].reduce(((e,a)=>t[`wday_${a}`]?e+`${0===e.length?"":", "}${be[a]}`:e),""):Object(r.b)("promotions.weekend")}},{title:Object(r.b)("words.status"),key:"status",dataIndex:"status",default_visible:!0,ellipsis:!0,width:120,render:(e,t)=>te(t)?Object(V.jsx)(ee.a,{color:"green",children:Object(r.b)("words.active",{context:"female"})}):Object(V.jsx)(ee.a,{color:"red",children:Object(r.b)("words.inactive",{context:"female"})})},{default_visible:!0,key:"actions",width:75,align:"center",render:(e,a)=>Object(V.jsxs)(ce.a,{width:75,children:[Object(V.jsx)(ie.a,{title:Object(r.b)("verbs.edit"),placement:"bottom",children:Object(V.jsx)(_.i,{className:"link",onClick:()=>{null!==n&&void 0!==n&&n.can_edit_promotion?t(a.id):s.b.warning(Object(r.b)("phrases.no_permission_to_do_this"))},children:Object(V.jsx)(de.a,{})})}),Object(V.jsx)($.a,{type:"vertical"}),Object(V.jsx)(_.i,{className:"link color-red",onClick:()=>i(a.id),children:Object(V.jsx)(l.a,{})})]})}]),[i,t,null===n||void 0===n?void 0:n.can_edit_promotion])},_e=a(2921);const me=e=>{let{promotion:t}=e;const a=[{title:`${Object(r.b)("words.product")}/${Object(r.b)("words.service")}`,key:"name",ellipsis:!0,render:(e,t)=>t.inventory_product.description},{title:Object(r.b)("words.discount"),key:"value",dataIndex:"value",align:"right",width:200,render:(e,t)=>"cents"===t.value_type?Object(N.d)(e,{cents:!1}):Object(N.u)(e,{symbol_position:"left"})},{key:"actions",width:75}];return Object(V.jsx)(je,{columns:a,dataSource:t.promotion_items,rowKey:"id",pagination:!1})};me.displayName="PromotionItems";var pe=me;const je=Object(D.d)(_e.a).withConfig({componentId:"wb__sc-qyyqhf-0"})([".ant-table-content{min-height:0 !important;height:auto !important;}.ant-table-expanded-row td{padding:12px 8px !important;}"]);t.default=()=>{const e=Object(o.useRef)(null),t=Object(o.useRef)(null),a=Object(m.a)((e=>e.current_user.permissions)),{destroyPromotion:i}=le(),u=Object(o.useCallback)((t=>{a.can_destroy_promotion?i(t,e.current.afterDestroyRecord):s.b.warning(Object(r.b)("phrases.no_permission_to_do_this"))}),[i,a.can_destroy_promotion]),_=Object(o.useCallback)((e=>Object(r.b)("phrases.confirm_delete",{model:Object(r.b)("words.promotion",{count:e.length}).toLocaleLowerCase(),count:e.length,context:"female"})),[]),p=Object(o.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.refetch()}),[]),j=Object(X.a)(a.can_destroy_promotion,_,u),h=Object(o.useCallback)((e=>{var a;null===(a=t.current)||void 0===a||a.open(e)}),[]),v=ue({openPromotionDrawer:h,handleDestroyPromotion:u,refetch:p}),O=se(),y=Object(o.useMemo)((()=>[{label:Object(r.b)("verbs.delete"),icon:Object(V.jsx)(l.a,{}),danger:!0,onClick:j,disabled:!a.can_destroy_promotion}]),[j,a.can_destroy_promotion]),f=Object(o.useCallback)((e=>{h(null===e||void 0===e?void 0:e.id)}),[h]),g=Object(o.useCallback)((e=>{var t;return(null===e||void 0===e||null===(t=e.all_promotions)||void 0===t?void 0:t.total_count)||0}),[]),w=Object(o.useCallback)((e=>{var t;return null===e||void 0===e||null===(t=e.all_promotions)||void 0===t?void 0:t.all}),[]),x=Object(o.useCallback)((()=>!0),[]),k=Object(o.useCallback)((e=>Object(V.jsx)(pe,{promotion:e})),[]),C=Object(o.useMemo)((()=>({expandedRowRender:k})),[k]);return Object(Z.a)({feature_keys:["has_promotions"],addon_keys:["has_promotions"],search:n.a.ID_PROMOTION}),Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(b.a,{ref:e,title:Object(r.b)("words.promotion",{count:2}),permissions_key:"promotion",search_placeholder:Object(r.b)("input.search_by_name"),filters:O,columns:v,mass_actions:y,query:c,select_all_query:d,getData:w,getTotalCount:g,openDrawer:f,MobileItem:re,validateRow:x,expandable:C}),Object(V.jsx)(Q,{ref:t,afterSave:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.refetch()}})]})}},609:function(e,t,a){"use strict";var o=a(0),r=a(50),s=a(159),n=a(53),l=a.n(n),i=a(19),c=a(22);const d=e=>{let{handleChangeRange:t}=e;return Object(c.jsx)(b,{children:u.map((e=>{let{label:a,value:o}=e;return Object(c.jsx)(s.a,{type:"primary",onClick:()=>t(o),children:a},a)}))})};d.displayName="ExtraRangeComponent",t.a=Object(o.memo)(d);const b=i.d.div.withConfig({componentId:"wb__sc-hoi2yi-0"})(["display:flex;flex-wrap:wrap;justify-content:space-between;padding-top:8px;.ant-btn{cursor:pointer;width:49%;text-align:center;margin-bottom:8px;margin-right:0;}"]),u=[{label:Object(r.b)("words.today"),value:[l()(),l()()]},{label:Object(r.b)("date.last_week"),value:[l()().startOf("week").subtract(1,"week"),l()().endOf("week").subtract(1,"week")]},{label:Object(r.b)("date.last_month"),value:[l()().subtract(1,"month").startOf("month"),l()().subtract(1,"month").endOf("month")]},{label:Object(r.b)("date.current_month"),value:[l()().startOf("month"),l()().endOf("month")]},{label:Object(r.b)("date.six_months_ago"),value:[l()().subtract(6,"month"),l()()]},{label:Object(r.b)("date.one_year_ago"),value:[l()().subtract(12,"month"),l()()]}]},610:function(e,t,a){"use strict";a.d(t,"d",(function(){return _})),a.d(t,"b",(function(){return m})),a.d(t,"c",(function(){return p})),a.d(t,"a",(function(){return j}));var o=a(19),r=a(0),s=a(2934),n=a(609),l=a(22);const i=(e,t)=>{let{onRangeChange:a,...o}=e;const[i,c]=Object(r.useState)(!1),b=Object(r.useCallback)((e=>{a(e)}),[a]);return Object(l.jsx)(s.a,{ref:t,showNow:!1,renderExtraFooter:()=>Object(l.jsx)(d,{children:Object(l.jsx)(n.a,{handleChangeRange:b})}),...o,open:i,onOpenChange:c})};i.displayName="SimpleRangePicker";var c=Object(r.memo)(Object(r.forwardRef)(i));const d=o.d.div.withConfig({componentId:"wb__sc-13lwjt0-0"})(["width:265px;"]),b={true:!0,false:!1,all:null,none:null},u=["start_date","end_date","birthday_start_date","birthday_end_date","start_date_open","start_date_close","end_date_open","end_date_close"],_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={},a={};return Object.entries(e).forEach((e=>{let[a,o]=e;o in b&&(t[a]=b[o])})),Object.entries(e).forEach((e=>{let[t,o]=e;u.includes(t)&&(a[t]=null===o||void 0===o?void 0:o.format("YYYY-MM-DD"))})),{...e,...t,...a}},m=o.d.div.withConfig({componentId:"wb__sc-gq8qm5-0"})(["display:flex;flex-direction:column;background-color:",";border-radius:16px;box-shadow:0 0 10px 5px #f3f3f3;padding:15px;border:1px solid rgba(0 0 0 / 3%);transition:box-shadow .1s;margin-bottom:5px;.ant-checkbox-wrapper + .ant-checkbox-wrapper{overflow:hidden;margin-left:0;width:100%;:not(:first-child){overflow:hidden;white-space:nowrap;text-overflow:ellipsis;word-break:keep-all;}}.ant-radio-wrapper{margin-right:0;}.ant-checkbox-group-item{margin-right:0;}.ant-calendar-picker-clear{background:transparent;color:",";}.ant-calendar-picker-input{border-top:none;border-left:none;border-right:none;border-radius:0;margin-top:5px;background:transparent;"," &:focus{box-shadow:none;}}.anticon-calendar{color:rgba(0,0,0,.2);}",""],(e=>e.theme.colors.white),(e=>e.theme.dark&&e.theme.dark_white),(e=>e.theme.dark&&`\n      border-color: ${e.theme.dark_secondary};\n      color: ${e.theme.dark_white};\n    `),(e=>e.tags&&Object(o.c)(["display:flex;flex-wrap:wrap;.ant-tag{margin:0 4px 4px 0;cursor:pointer;}"]))),p=Object(o.d)(c).withConfig({componentId:"wb__sc-gq8qm5-1"})(["width:100%;border-top:none;border-left:none;border-right:none;border-radius:0 !important;margin-top:5px;background:transparent;&.ant-picker-focused{box-shadow:none;}"]),j=o.d.div.withConfig({componentId:"wb__sc-gq8qm5-2"})(["min-width:0;width:0;z-index:210;text-overflow:ellipsis;white-space:nowrap;position:sticky;top:calc(","px + 10px);overflow:hidden;max-height:calc(100vh - 60px);align-self:flex-start;transition:width .2s;",""],(e=>e.theme.menu_top_height),(e=>!!e.$visible&&Object(o.c)(["min-width:230px;width:230px;padding-right:7px;overflow-y:auto;overflow-x:hidden;"])))},627:function(e,t,a){"use strict";var o=a(0),r=a(50),s=a(2937),n=a(137),l=a(578),i=a(116),c=a(585),d=a(28),b=a(598);const u={show_filters:!1,page:1,results:20,sort_field:"name",sort_order:"ascend",filters_value:{},visible_columns:[]};var _=(e,t)=>{if(t.type.includes("set_")&&"payload"in t){const a=t.type.split("set_")[1];return{...e,[a]:t.payload}}return e},m=a(53),p=a.n(m),j=a(635),h=a(22);const v={ascend:"ASC",descend:"DESC"},O=e=>e?p()(e):null;var y=a(405),f=a(610),g=a(27),w=a(582),x=a(1814),k=a(148);var C=e=>{const{total_count:t,records:a,results:s,select_all_query:n,validateRow:l=(e=>!0),rowSelector:c=(e=>e.map((e=>e.id)))}=e,[d,b]=Object(o.useState)([]),[u,_]=Object(o.useState)(!1),[m,p]=Object(o.useState)(!1),[j,v]=Object(o.useState)(!1),O=Object(k.a)(),y=Object(o.useCallback)((()=>{_(!1),b([]),v(!1)}),[]),f=Object(o.useCallback)((()=>{const e=i.b.loading(`${Object(r.b)("verbs.selecting")}...`,0);p(!0);const{query:t,variables:a,resolve:o}=n;O.query({query:t,variables:a,fetchPolicy:"network-only"}).then(o((e=>{_(!0),b(c(e))}))).catch((e=>console.error(e))).then((()=>{e(),p(!1)}))}),[O,c,n]),g=Object(o.useCallback)(((e,t)=>{b(c(t))}),[]),w=Object(o.useMemo)((()=>a.filter(l)),[a,l]);return Object(o.useMemo)((()=>({setSelectedRows:b,selected_all:u,selected_rows:d,validated_records:w,total_count:t,resetSelected:y,records:a,results:s,selectAll:f,onChange:g,is_select_mode:j,setIsSelectMode:v,is_selecting_all:m,setSelectedAll:_,setIsSelectingAll:p,getCheckboxProps:e=>({disabled:!l(e)}),selectedRowKeys:d.map((e=>(null===e||void 0===e?void 0:e.id)||e)),columnTitle:Object(h.jsx)(x.a,{className:"table-select-all",indeterminate:!u&&!!d.length&&d.length!==t,checked:u||d.length===t&&t>0,onChange:()=>{if(d.length<w.length)return b(c(w));y()}})})),[u,d,t,y,a,s,f,g,l,w,j,v,m])},S=a(597),$=a(232);const I=Object(o.lazy)((()=>Object($.a)((()=>a.e(12).then(a.bind(null,968)))))),P=Object(o.lazy)((()=>Object($.a)((()=>a.e(7).then(a.bind(null,969)))))),M=()=>{const e=Object(b.b)((e=>e.onSearch)),t=Object(b.b)((e=>e.title));return Object(h.jsx)(S.b,{title:t,onSearch:e,children:Object(h.jsx)(w.a,{Desktop:I,Mobile:P})})};M.displayName="DefaultHeader";var q=M,N=a(76);const F=Object(o.lazy)((()=>Object($.a)((()=>a.e(94).then(a.bind(null,2909)))))),D=Object(o.lazy)((()=>Object($.a)((()=>a.e(67).then(a.bind(null,3082)))))),R=e=>!(null===e||void 0===e||!e.active),V=e=>null===e||void 0===e?void 0:e.id,L=(e,t)=>{var a,m;const{columns:p,filters:x,extra_actions:k,query:S,getTotalCount:$,getData:I,select_all_query:P,validateRow:M=R,rowSelectorKey:L=V,Header:z,expandedRowKeys:E,title:T,storage_key:Y=T,has_feature:A=!0,use_storage:K=!0,addon_id:H,has_joyride:B=!0,show_create_button:J=!0,item_selectable:U=!0,parseFilters:W=f.d,rowClassName:G,mobileSwipeLeft:Q}=e,X=Object(g.a)((e=>e.current_user.permissions)),Z=Object(g.a)((e=>e.is_mobile)),ee=`MagicTableStorage: ${Y}`,[te]=s.a.useForm(),ae=(null===(a=p.find((e=>e.sorter)))||void 0===a?void 0:a.key)||p[0].key,oe=(null===(m=p.find((e=>e.defaultSortOrder)))||void 0===m?void 0:m.defaultSortOrder)||p[0].defaultSortOrder||"ascend",re=Object(o.useMemo)((()=>(e=>{const{default_sort_order:t,default_sort_field:a,filters:o,local_storage_key:r,visible_columns:s,use_storage:n}=e,l=Object(d.c)(r);if(l&&n){const e=null===l||void 0===l?void 0:l.filters_value;return null!==e&&void 0!==e&&e.start_date||null!==e&&void 0!==e&&e.end_date||null!==e&&void 0!==e&&e.birthday_start_date||null!==e&&void 0!==e&&e.birthday_end_date||null!==e&&void 0!==e&&e.start_date_open||null!==e&&void 0!==e&&e.start_date_close||null!==e&&void 0!==e&&e.end_date_open||null!==e&&void 0!==e&&e.end_date_close?{...l,filters_value:{...l.filters_value,start_date:O(l.filters_value.start_date),end_date:O(l.filters_value.end_date),birthday_start_date:O(l.filters_value.birthday_start_date),birthday_end_date:O(l.filters_value.birthday_end_date),start_date_open:O(l.filters_value.start_date_open),start_date_close:O(l.filters_value.start_date_close),end_date_open:O(l.filters_value.end_date_open),end_date_close:O(l.filters_value.end_date_close)}}:l}const i=null===o||void 0===o?void 0:o.reduce(((e,t)=>t.default_value?t.rangepicker?{...e,[t.rangepicker.start_date_name]:t.default_value[0],[t.rangepicker.end_date_name]:t.default_value[1]}:{...e,[t.name]:t.default_value}:e),{});return{...u,sort_field:a,sort_order:v[t],filters_value:i,visible_columns:s}})({local_storage_key:ee,filters:x,default_sort_field:ae,default_sort_order:oe,visible_columns:p.filter((e=>e.default_visible)).map((e=>e.key)),use_storage:K})),[p,ae,oe,x,ee,K]),[se,ne]=Object(o.useReducer)(_,re);Object(l.a)((()=>{Object(d.d)(ee,{...se,page:1})}),[se]);const[le,ie]=Object(o.useState)(""),[ce,de]=Object(o.useState)([]),[be,ue]=Object(o.useState)(0),_e=Object(o.useRef)(!1),me=(e=>{const{columns:t,visible_columns:a=[],dispatch:o}=e,r=t.filter((e=>a.includes(e.key)||e.always_visible)),s=r.findIndex((e=>"actions"===e.key));return s&&(r[s]={...r[s],title:Object(h.jsx)(j.a,{columns:t,visible_columns:a,dispatch:o})}),r})({dispatch:ne,columns:p,visible_columns:se.visible_columns}),pe={...Object(o.useMemo)((()=>p.filter((e=>e.include_key_on_query)).reduce(((e,t)=>{var a;return e[t.key]=null===(a=se.visible_columns)||void 0===a?void 0:a.includes(t.key),e}),{})),[p,se.visible_columns]),...W(se.filters_value),is_mobile:Z,search_query:le,sort_field:se.sort_field,sort_order:se.sort_order,page:se.page,results:se.results},{loading:je,refetch:he}=Object(y.f)(S,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0,variables:pe,skip:!A,onError:e=>{console.log(e),N.a.captureException(e),i.b.error(Object(r.b)("phrases.loading_error"))},onCompleted:e=>{ue($(e)),1!==se.page&&_e.current?de((t=>[...t,...I(e)||[]])):de(I(e)||[])}}),ve=Object(o.useCallback)((()=>{if(1===se.page)return he();ne({type:"set_page",payload:1})}),[se.page,he]),Oe=Object(o.useCallback)((()=>{_e.current=!0,ne({type:"set_page",payload:se.page+1})}),[se.page]),ye=Object(o.useCallback)(((e,t,a)=>{a.order&&(ne({type:"set_sort_field",payload:a.field}),ne({type:"set_sort_order",payload:"ascend"===a.order?"ASC":"DESC"})),e.current&&ne({type:"set_page",payload:e.current}),e.pageSize&&ne({type:"set_results",payload:e.pageSize})}),[]),fe=C({total_count:be,results:se.results,records:ce,select_all_query:{query:P,variables:pe,resolve:e=>t=>{let{data:a}=t;return e(I(a)||[])}},validateRow:M,rowSelector:Object(o.useCallback)((e=>e.filter(M).map(L)),[L,M])}),ge=Object(o.useMemo)((()=>E?E(ce):void 0),[ce,E]),we=Object(o.useCallback)((e=>{he(),fe.resetSelected();const t=Math.ceil((be-e)/se.results);se.page>t&&ne({type:"set_page",payload:t})}),[se.page,he,se.results,fe,be]),xe=Object(o.useCallback)((e=>{ne({type:"set_page",payload:1}),ie(e)}),[ie]),ke=Object(o.useCallback)((e=>{ne({type:"set_filters_value",payload:e}),ne({type:"set_page",payload:1})}),[]),Ce=Object(o.useMemo)((()=>A?e.permissions?e.permissions:e.permissions_key?{can_create:X[`can_create_${e.permissions_key}`],can_edit:X[`can_edit_${e.permissions_key}`],can_access:X[`can_access_${e.permissions_key}`]}:void 0:{can_create:!1,can_edit:!1,can_access:!1}),[A,e.permissions,e.permissions_key,X]),Se=Object(o.useCallback)((()=>{if(fe.resetSelected(),Z)return 1===se.page?void he():void ne({type:"set_page",payload:1});he()}),[Z,he,fe,se.page]);Object(o.useImperativeHandle)(t,(()=>({afterDestroyRecord:we,refetch:Se})));const $e=Object(o.useMemo)((()=>({onSearch:xe,row_selection:fe,onFiltersChange:ke,data_source:ce,form:te,total_count:be,loading:je,new_columns:me,onChange:ye,expanded_row_keys:ge,refetch:ve,handleFetchMore:Oe,...e,has_feature:A,addon_id:H,has_joyride:B,show_create_button:J,item_selectable:U,validateRow:M,rowSelectorKey:L,permissions:Ce,...se,dispatch:ne,rowClassName:G,extra_actions:k})),[xe,fe,ke,ce,te,be,je,me,ye,ge,ve,Oe,e,A,B,J,M,L,Ce,se,G,k,U,H]),Ie=Object(o.useMemo)((()=>null===x||void 0===x?void 0:x.reduce(((e,t)=>t.default_value?t.rangepicker?{...e,[t.rangepicker.start_date_name]:t.default_value[0],[t.rangepicker.end_date_name]:t.default_value[1]}:{...e,[t.name]:t.default_value}:e),{})),[x]);return Object(h.jsx)(b.a.Provider,{value:$e,children:Object(h.jsxs)(c.b,{children:[z?Object(h.jsx)(z,{}):Object(h.jsx)(q,{}),Object(h.jsx)(s.a,{form:te,component:!1,layout:"vertical",onChange:Object(n.debounce)(ke,1e3),initialValues:{...Ie,...se.filters_value},children:Object(h.jsx)(w.a,{Desktop:F,Mobile:D,mobileSwipeLeft:Q})})]})})};L.displayName="MagicTable";t.a=Object(o.memo)(Object(o.forwardRef)(L))},635:function(e,t,a){"use strict";var o=a(0),r=a(50),s=a(1809),n=a(852),l=a(1814),i=a(3052),c=a(19),d=a(22);const b=e=>{let{columns:t,visible_columns:a,dispatch:l,setVisibleColumns:c}=e;const[b,_]=Object(o.useState)(!1),m=Object(o.useCallback)((()=>{const e=t.filter((e=>e.default_visible)).map((e=>e.key));null===l||void 0===l||l({type:"set_visible_columns",payload:e}),null===c||void 0===c||c(e)}),[t,l,c]),p=Object(o.useCallback)((e=>{if(a.includes(e)){const t=a.filter((t=>t!==e));return null===l||void 0===l||l({type:"set_visible_columns",payload:t}),void(null===c||void 0===c||c(t))}const t=[...a,e];null===l||void 0===l||l({type:"set_visible_columns",payload:t}),null===c||void 0===c||c(t)}),[l,c,a]),j=Object(o.useMemo)((()=>{const e=t.reduce(((e,t)=>{if(!t.title||t.always_visible)return e;const o={key:t.key,disabled:t.always_visible,label:Object(d.jsx)(u,{onClick:()=>p(t.key),checked:a.includes(t.key),children:t.title})};return[...e,o]}),[]);return[{key:"default_title",type:"group",label:Object(d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(d.jsx)("span",{children:Object(r.b)("words.column",{count:2})}),Object(d.jsx)("button",{className:"link",onClick:m,children:Object(r.b)("words.default")})]}),children:e}]}),[t,m,p,a]);return Object(d.jsx)(s.a,{menu:{items:j},trigger:["click"],open:b,onOpenChange:_,className:"no-print table-configuration",children:Object(d.jsx)(n.a,{title:Object(r.b)("phrases.column_settings"),placement:"left",children:Object(d.jsx)("div",{className:"link no-print",style:{fontSize:"15px"},children:Object(d.jsx)(i.a,{})})})})};b.displayName="ColumnsSettings",t.a=b;const u=Object(c.d)(l.a).withConfig({componentId:"wb__sc-1oenz8-0"})(["width:100%;"])},667:function(e,t,a){"use strict";var o=a(0),r=a(50),s=a(116);t.a=(e,t,a)=>Object(o.useCallback)((o=>{e?s.c.confirm({centered:!0,className:"webook-modal",title:Object(r.b)("words.attention"),maskClosable:!0,content:t(o),okText:Object(r.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(r.b)("verbs.cancel"),onOk:()=>{a(o)}}):s.b.warning(Object(r.b)("phrases.no_permission_to_do_this"))}),[a,e,t])}}]);
//# sourceMappingURL=101.72223056.chunk.js.map