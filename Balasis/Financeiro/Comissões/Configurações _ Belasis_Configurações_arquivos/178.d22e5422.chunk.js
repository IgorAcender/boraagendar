(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[178],{1049:function(e,t,a){"use strict";var c=a(37),n=a(405);const i=c.e`
  query FinanceDashboardCashFlow ($start_date: String!, $end_date: String!, $force_reload: Boolean) {
    finance_cash_flow(start_date: $start_date, end_date: $end_date, force_reload: $force_reload) {
      date paid received
    }
  }
`;t.a=(e,t,a)=>Object(n.f)(i,{fetchPolicy:"network-only",variables:{start_date:e,end_date:t,force_reload:a}})},2946:function(e,t,a){"use strict";a.r(t);var c=a(0),n=a(50),i=a(543),o=a(2883),d=a(19),s=a(585),l=a(27),r=a(593),b=a(250),j=a(20),h=a(356),u=a(579),O=a(583),_=a(37),p=a(405),v=a(76),m=a(53),x=a.n(m);const f=_.e`
  query AvailableBills ($start_date: String, $end_date: String) {
    finance_bills (
      start_date: $start_date, end_date: $end_date, bill_type: "both", no_transfer: true, status: [0],
      date_type: "available_at"
    ) {
      all {
        ... on BillPay {
          id value_cents bill_type
        }

        ... on BillRec {
          id value_cents bill_type
        }
      }
    }
  }
`;var y=()=>{const e=x()().format("YYYY-MM-DD");return Object(p.f)(f,{fetchPolicy:"network-only",variables:{start_date:e,end_date:e},onError:e=>{v.a.captureException(e),console.log(e)}})},g=a(22);const w=()=>{const e=Object(l.a)((e=>e.finance_charts)).filter((e=>!e.deleted_at)),t=Object(l.a)((e=>e.finance_payments)),a=Object(l.a)((e=>e.finance_accounts)),i=Object(j.o)(),{data:o,loading:d}=y(),s=Object(c.useMemo)((()=>{const e=null===o||void 0===o?void 0:o.finance_bills.all.filter((e=>"rec"===e.bill_type));return null===e||void 0===e?void 0:e.reduce(((e,t)=>e+t.value_cents),0)}),[null===o||void 0===o?void 0:o.finance_bills]),r=Object(c.useMemo)((()=>{const e=null===o||void 0===o?void 0:o.finance_bills.all.filter((e=>"pay"===e.bill_type));return null===e||void 0===e?void 0:e.reduce(((e,t)=>e+t.value_cents),0)}),[null===o||void 0===o?void 0:o.finance_bills]),_=c=>{const n={bill_type:[c],start_date:x()().format("YYYY-MM-DD"),end_date:x()().format("YYYY-MM-DD"),status:["0","2"],payments:t.map((e=>e.id)),accounts:a.map((e=>e.id)),charts:e.filter((e=>"Transfer"!==e.default)).map((e=>e.id))},o=`/finance/transactions?${new URLSearchParams(n).toString()}`;i(o)};return Object(g.jsx)(O.a.Provider,{value:d,children:Object(g.jsxs)(Y,{children:[Object(g.jsx)(b.h,{$size:20,$bold:!0,children:Object(n.b)("words.summary")}),Object(g.jsxs)(k,{onClick:()=>_("rec"),children:[Object(g.jsxs)("div",{style:{color:"#5cb85c"},children:[Object(g.jsx)(b.h,{$size:18,$block:!0,children:Object(n.b)("finance.dashboard.due_today")}),Object(g.jsx)(O.b,{width:10,$size:24,$bold:!0,$block:!0,children:Object(u.d)(s)})]}),Object(g.jsx)(b.d,{as:h.a,$hex:"#5cb85c"})]}),Object(g.jsxs)(k,{onClick:()=>_("pay"),children:[Object(g.jsxs)("div",{style:{color:"#c73d3d"},children:[Object(g.jsx)(b.h,{$size:18,$block:!0,children:Object(n.b)("finance.dashboard.payable_today")}),Object(g.jsx)(O.b,{width:10,$size:24,$bold:!0,$block:!0,children:Object(u.d)(r)})]}),Object(g.jsx)(b.d,{as:h.a,$hex:"#c73d3d"})]})]})})};w.displayName="AvailableBills";var $=w;const Y=d.d.div.withConfig({componentId:"wb__sc-u678pu-0"})(["display:flex;flex-direction:column;height:225px;position:relative;"]),k=d.d.div.withConfig({componentId:"wb__sc-u678pu-1"})(["",";display:flex;background-color:#FFFFFF;align-items:center;justify-content:space-between;border-radius:5px;padding:10px;box-shadow:rgba(99,99,99,0.2) 0 2px 8px 0;margin-bottom:10px;cursor:pointer;"],(e=>!e.theme.is_mobile&&Object(d.c)(["width:180px;height:90px;"])));var C=a(597),D=a(2901),F=a(2995),M=a(2902),S=a(877),z=a(878),P=a(2837),A=a(1006),I=a(606);const N=_.e`
  query FinanceDashboardSalesPerDay ($start_date: String!, $end_date: String!) {
    finance_sales_per_day (start_date: $start_date, end_date: $end_date) {
      date value
    }
  }
`;var B=(e,t)=>Object(p.f)(N,{fetchPolicy:"network-only",variables:{start_date:e,end_date:t}}),L=a(339);const R=()=>{const e=Object(d.f)(),[t,a]=Object(c.useState)(x()().subtract(14,"days")),[i,o]=Object(c.useState)(x()()),{data:s,loading:l}=B(t.format("YYYY-MM-DD"),i.format("YYYY-MM-DD")),r=Object(c.useMemo)((()=>((null===s||void 0===s?void 0:s.finance_sales_per_day)||[]).map((e=>{let{date:t,value:a}=e;return{date:x()(t).format("L"),value:a}}))),[null===s||void 0===s?void 0:s.finance_sales_per_day]),j=Object(c.useCallback)((e=>{const t=null===e||void 0===e?void 0:e[0],c=null===e||void 0===e?void 0:e[1];t&&c&&(a(t),o(c))}),[]);return Object(g.jsxs)(K,{children:[Object(g.jsxs)(b.g,{$top:30,$bottom:10,justify:"space-between",children:[Object(g.jsx)(b.h,{$size:20,$bold:!0,children:Object(n.b)("finance.dashboard.sales_per_day")}),Object(g.jsx)(I.a,{variant:"borderless",placement:"bottomRight",allowClear:!1,format:"L",value:[t,i],onChange:j,getPopupContainer:()=>document.body})]}),Object(g.jsx)(L.a,{loading:l}),Object(g.jsx)(D.a,{height:295,children:Object(g.jsxs)(F.a,{data:r,children:[Object(g.jsx)(M.a,{strokeDasharray:"3 3"}),Object(g.jsx)(S.a,{dataKey:"date"}),Object(g.jsx)(z.a,{}),Object(g.jsx)(P.a,{formatter:e=>Object(u.d)(e,{cents:!1})}),Object(g.jsx)(A.a,{dataKey:"value",name:Object(n.b)("words.value"),fill:e.color_primary,opacity:"0.75",isAnimationActive:!0})]},null===r||void 0===r?void 0:r.length)})]})};R.displayName="SalesPerDay";var q=R;const K=d.d.div.withConfig({componentId:"wb__sc-1h1pp8y-0"})(["width:100%;overflow:hidden;position:relative;margin-bottom:20px;"]);var T=a(1036),H=a.n(T);const E=_.e`
  query FinanceDashboardAccounts {
    finance_accounts(active: true) {
      id name balance_cents
    }
  }
`;var J=()=>Object(p.f)(E,{fetchPolicy:"network-only"});const U=e=>{let{account:t}=e;const a=Object(c.useMemo)((()=>t?0===t.balance_cents?"#f5a139":t.balance_cents>0?"#5cb85c":"#c73d3d":"#FFFFFF"),[t]);return Object(g.jsx)(G,{$color:a,children:Object(g.jsxs)("div",{children:[Object(g.jsx)(O.b,{width:"80%",$size:18,$block:!0,children:null===t||void 0===t?void 0:t.name}),Object(g.jsx)(O.b,{width:5,$size:24,$bold:!0,$block:!0,children:Object(u.d)(null===t||void 0===t?void 0:t.balance_cents)})]})})};U.displayName="Account";var V=U;const G=d.d.div.withConfig({componentId:"wb__sc-1tme506-0"})([""," background:",";color:#FFFFFF;border-radius:5px;padding:10px;box-shadow:rgba(99,99,99,0.2) 0 2px 8px 0;margin-bottom:10px;"],(e=>!e.theme.is_mobile&&Object(d.c)(["width:180px;"])),(e=>e.$color)),Q=()=>{const e=Object(l.a)((e=>e.current_user.permissions)),t=Object(l.a)((e=>e.is_mobile)),{data:a,loading:i}=J(),o=Object(c.useMemo)((()=>{const t=(null===a||void 0===a?void 0:a.finance_accounts)||[];return e.is_admin?t:t.filter((e=>!e.admin_only))}),[null===a||void 0===a?void 0:a.finance_accounts,e.is_admin]);return e.can_access_finance?Object(g.jsx)(O.a.Provider,{value:i,children:Object(g.jsxs)(X,{children:[Object(g.jsx)(b.h,{$size:20,$bold:!0,children:Object(n.b)("words.account",{count:2})}),Object(g.jsx)(H.a,{autoHide:!t,autoHeight:t,autoHeightMax:400,children:i?[-3,-2,-1].map((e=>Object(g.jsx)(V,{},`account-${e}`))):o.map((e=>Object(g.jsx)(V,{account:e},e.id)))})]})}):null};Q.displayName="Accounts";var W=Q;const X=d.d.div.withConfig({componentId:"wb__sc-519q22-0"})([""," margin-bottom:15px;position:relative;"],(e=>!e.theme.is_mobile&&Object(d.c)(["width:200px;height:calc(100% - 275px);"])));var Z=a(1840),ee=a(2235),te=a(1049);const ae=()=>{const e=Object(d.f)(),[t,a]=Object(c.useState)(x()().subtract(14,"days")),[i,o]=Object(c.useState)(x()()),{data:s,loading:l}=Object(te.a)(t.format("YYYY-MM-DD"),i.format("YYYY-MM-DD")),r=Object(c.useMemo)((()=>{let e=0;return null===s||void 0===s?void 0:s.finance_cash_flow.map((t=>{let{date:a,paid:c,received:n}=t;return e+=n-c,{received:n,paid:-c,balance:e,date:x()(a).format("L")}}))}),[null===s||void 0===s?void 0:s.finance_cash_flow]),j=Object(c.useCallback)((e=>{const t=null===e||void 0===e?void 0:e[0],c=null===e||void 0===e?void 0:e[1];t&&c&&(a(t),o(c))}),[]);return Object(g.jsxs)(ne,{children:[Object(g.jsxs)(b.g,{justify:"space-between",children:[Object(g.jsx)(b.h,{$size:20,$bold:!0,children:Object(n.b)("words.cash_flow")}),Object(g.jsx)(I.a,{variant:"borderless",placement:"bottomRight",allowClear:!1,format:"L",value:[t,i],onChange:j,getPopupContainer:()=>document.body})]}),Object(g.jsx)(L.a,{loading:l}),Object(g.jsx)(D.a,{height:295,children:Object(g.jsxs)(F.a,{data:r,children:[Object(g.jsx)(M.a,{strokeDasharray:"3 3"}),Object(g.jsx)(S.a,{dataKey:"date"}),Object(g.jsx)(z.a,{}),Object(g.jsx)(Z.a,{}),Object(g.jsx)(P.a,{formatter:e=>Object(u.d)(e,{cents:!1})}),Object(g.jsx)(A.a,{dataKey:"received",name:Object(n.b)("words.cash_income"),stackId:"a",fill:"#5cb85c",opacity:"0.75",isAnimationActive:!0}),Object(g.jsx)(A.a,{dataKey:"paid",name:Object(n.b)("words.cash_outflow"),stackId:"a",fill:"#c73d3d",opacity:"0.75",isAnimationActive:!0}),Object(g.jsx)(ee.a,{dataKey:"balance",name:Object(n.b)("finance.dashboard.accumulated_balance"),type:"monotone",stroke:e.color_primary,isAnimationActive:!1,dot:!1})]},null===r||void 0===r?void 0:r.length)})]})};ae.displayName="CashFlow";var ce=ae;const ne=d.d.div.withConfig({componentId:"wb__sc-1925zls-0"})(["width:100%;overflow:hidden;position:relative;"]);var ie=a(628);const oe=_.e`
  query FinanceDashboardTotals ($start_date: String!, $end_date: String!) {
    finance_totals (start_date: $start_date, end_date: $end_date) {
      received to_receive paid to_pay
    }
  }
`;var de=(e,t)=>Object(p.f)(oe,{fetchPolicy:"network-only",variables:{start_date:e,end_date:t}});const se=e=>{let{name:t,color:a,value:c,onClick:n}=e;return Object(g.jsxs)(re,{onClick:n,$color:a,children:[Object(g.jsxs)("div",{style:{color:"#FFFFFF"},children:[Object(g.jsx)(b.h,{$size:18,$block:!0,children:t}),Object(g.jsx)(O.b,{width:"55%",$size:24,$bold:!0,$block:!0,children:Object(u.d)(c)})]}),Object(g.jsx)(b.d,{as:h.a,$color:"white"})]})};se.displayName="Total";var le=se;const re=d.d.div.withConfig({componentId:"wb__sc-1hd3h3j-0"})([""," background:",";border-radius:5px;padding:10px;display:flex;justify-content:space-between;box-shadow:rgba(99,99,99,0.2) 0 2px 8px 0;margin-bottom:10px;cursor:pointer;box-sizing:border-box;"],(e=>!e.theme.is_mobile&&d.c`
    width: 24%;
  `),(e=>e.$color)),be=()=>{const[e,t]=Object(c.useState)(x()().subtract(14,"days")),[a,i]=Object(c.useState)(x()()),o=Object(j.o)(),d=Object(c.useRef)(null),s=Object(l.a)((e=>e.is_mobile)),r=Object(l.a)((e=>e.finance_charts)).filter((e=>!e.deleted_at)),h=Object(l.a)((e=>e.finance_payments)),u=Object(l.a)((e=>e.finance_accounts)),{data:_,loading:p}=de(e.format("YYYY-MM-DD"),a.format("YYYY-MM-DD")),v=null===_||void 0===_?void 0:_.finance_totals,{received:m=0,to_receive:f=0,paid:y=0,to_pay:w=0}=v||{},$=Object(c.useCallback)((e=>{const a=null===e||void 0===e?void 0:e[0],c=null===e||void 0===e?void 0:e[1];a&&c&&(t(a),i(c))}),[]),Y=(t,c,n)=>{const i={bill_type:t,start_date:e.format("YYYY-MM-DD"),end_date:a.format("YYYY-MM-DD"),status:c,date_type:n,payments:h.map((e=>e.id)),accounts:u.map((e=>e.id)),charts:r.filter((e=>"Transfer"!==e.default)).map((e=>e.id))},d=`/finance/transactions?${new URLSearchParams(i).toString()}`;o(d)};return Object(g.jsxs)(O.a.Provider,{value:p,children:[Object(g.jsxs)(b.g,{justify:"space-between",$alignCenter:!0,children:[Object(g.jsx)(b.h,{$size:20,$bold:!0,children:Object(n.b)("words.total",{count:2})}),s?Object(g.jsx)(b.h,{onClick:()=>{var e;return null===(e=d.current)||void 0===e?void 0:e.open()},$semibold:!0,children:Object(g.jsx)(b.f,{start_date:e,end_date:a})}):Object(g.jsx)(I.a,{variant:"borderless",placement:"bottomRight",allowClear:!1,format:"L",getPopupContainer:()=>document.body,value:[e,a],onChange:$})]}),Object(g.jsxs)(he,{children:[Object(g.jsx)(le,{onClick:()=>Y("rec",["3"],"compensated"),name:Object(n.b)("finance.dashboard.received"),color:"#5cb85c",value:m}),Object(g.jsx)(le,{onClick:()=>Y("rec",["0","2","4","5"],"available_at"),name:Object(n.b)("finance.dashboard.to_receive"),color:"#2196F3",value:f}),Object(g.jsx)(le,{onClick:()=>Y("pay",["3"],"compensated"),name:Object(n.b)("finance.dashboard.paid"),color:"#f5a139",value:y}),Object(g.jsx)(le,{onClick:()=>Y("pay",["0","2","4","5"],"available_at"),name:Object(n.b)("finance.dashboard.to_pay"),color:"#c73d3d",value:w})]}),Object(g.jsx)(ie.a,{ref:d,defaultValue:[e.toDate(),a.toDate()],onConfirm:function(){if(!(arguments.length<=0?void 0:arguments[0])||!(arguments.length<=1?void 0:arguments[1]))return;const e=x()(arguments.length<=0?void 0:arguments[0]),a=x()(arguments.length<=1?void 0:arguments[1]);t(e),i(a)},type:"range"})]})};be.displayName="Totals";var je=be;const he=d.d.div.withConfig({componentId:"wb__sc-15zk8kl-0"})([""," justify-content:space-between;margin:0 0 15px 0;"],(e=>!e.theme.is_mobile&&Object(d.c)(["display:flex;"]))),ue=()=>{Object(r.a)({feature_keys:["has_finance_dashboard"]});const e=Object(l.a)((e=>e.is_mobile)),t=Object(l.a)((e=>e.is_medium));return Object(g.jsxs)(s.b,{children:[Object(g.jsx)(C.b,{title:Object(n.b)("words.panel"),$showBottomBorder:!0}),Object(g.jsx)(Oe,{children:e?Object(g.jsxs)(i.a,{style:{width:"100%"},children:[Object(g.jsx)(o.a,{span:24,children:Object(g.jsx)($,{})}),Object(g.jsx)(o.a,{span:24,children:Object(g.jsx)(W,{})}),Object(g.jsx)(o.a,{span:24,children:Object(g.jsx)(je,{})}),t&&Object(g.jsxs)(_e,{children:[Object(g.jsx)(ce,{}),Object(g.jsx)(q,{})]})]}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("div",{children:[Object(g.jsx)($,{}),Object(g.jsx)(W,{})]}),Object(g.jsxs)(_e,{children:[Object(g.jsx)(je,{}),Object(g.jsx)(ce,{}),Object(g.jsx)(q,{})]})]})})]})};ue.displayName="Dashboard";t.default=ue;const Oe=Object(d.d)(s.c).withConfig({componentId:"wb__sc-14jzbfn-0"})(["padding:10px 0 0 0;margin:0;overflow:hidden;",""],(e=>e.theme.is_mobile&&Object(d.c)(["padding:0 15px ","px;"],(e=>e.theme.sidebar_mobile_bottom_margin)))),_e=d.d.div.withConfig({componentId:"wb__sc-14jzbfn-1"})(["flex:1;padding-left:15px;margin-right:15px;height:100%;",""],(e=>e.theme.is_mobile&&Object(d.c)(["margin-right:0;padding-left:0;"])))}}]);
//# sourceMappingURL=178.d22e5422.chunk.js.map