(this["webpackJsonpwebook-react"]=this["webpackJsonpwebook-react"]||[]).push([[89],{1193:function(e,t,n){"use strict";var o=n(0),c=n(50),s=n(116),a=n(37),r=n(1850),i=n(76);const l=a.e`
  mutation DestroyBonification ($data: DestroyBonificationInput!) {
    destroyBonification(input: $data) {
      success
      errors
    }
  }
`;t.a=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const[t,{loading:n}]=Object(r.a)(l),a=Object(o.useCallback)((async n=>{try{const{data:o}=await t({variables:{data:{id:n}}}),{success:a=!1,errors:r=[]}=(null===o||void 0===o?void 0:o.destroyBonification)||{};return a&&e&&s.b.success(`${Object(c.b)("phrases.deleted_successfully",{prefix:Object(c.b)("words.bonification"),context:"female"})}`),e&&(null===r||void 0===r||r.forEach((e=>s.b.error(e)))),{success:a}}catch(o){return i.a.captureException(o),s.b.error(Object(c.b)("phrases.generic_save_error_message")),console.error(o),{success:!1}}}),[t,e]);return[a,{loading:n}]}},1194:function(e,t,n){"use strict";var o=n(0),c=n(50),s=n(116),a=n(37),r=n(1850),i=n(76);const l=a.e`
  mutation GenerateBonification ($data: GenerateBonificationInput!) {
    generateBonification(input: $data) {
      success
      errors
    }
  }
`;t.a=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const[t,{loading:n}]=Object(r.a)(l),a=Object(o.useCallback)((async n=>{try{const{data:o}=await t({variables:{data:n}}),{success:a=!1,errors:r=[]}=(null===o||void 0===o?void 0:o.generateBonification)||{};return a&&e&&s.b.success(Object(c.b)("goals.bonus_generated_successfully")),e&&(null===r||void 0===r||r.forEach((e=>s.b.error(e)))),{success:a}}catch(o){return i.a.captureException(o),s.b.error(Object(c.b)("phrases.generic_save_error_message")),console.error(o),{success:!1}}}),[t,e]);return[a,{loading:n}]}},1417:function(e,t,n){"use strict";var o=n(0),c=n(50),s=n(116),a=n(1193);t.a=()=>{const[e,t]=Object(o.useState)(!1),[n]=Object(a.a)(!1);return[Object(o.useCallback)((async e=>{if(0===e.length)return{successes:0,failures:0};t(!0);const o=s.b.loading(`${Object(c.b)("verbs.wait")}...`,0),a=[],r=[],i=e.map((e=>new Promise(((t,o)=>{n(e).then((t=>{let{success:n}=t;if(!n)return r.push(e);a.push(e)})).catch((()=>r.push(e))).then((()=>t(!0)))}))));return await Promise.all(i).finally((()=>{o(),t(!1)})),r.length>0&&s.b.error(`${r.length} ${Object(c.b)("phrases.cant_be_deleted",{prefix:Object(c.b)("words.bonification",{count:r.length}).toLocaleLowerCase(),count:r.length,context:"female"})}`),a.length>0&&s.b.success(`${a.length} ${Object(c.b)("phrases.deleted_successfully",{prefix:Object(c.b)("words.bonification",{count:a.length}).toLocaleLowerCase(),count:a.length,context:"female"})}`),{successes:a.length,failures:r.length}}),[n]),{loading:e}]}},1418:function(e,t,n){"use strict";var o=n(0),c=n(50),s=n(116),a=n(1194);t.a=()=>{const[e,t]=Object(o.useState)(!1),[n]=Object(a.a)(!1);return[Object(o.useCallback)((async e=>{if(0===e.length)return{successes:0,failures:0};t(!0);const o=s.b.loading(`${Object(c.b)("verbs.wait")}...`,0),a=[],r=[],i=e.map((e=>new Promise(((t,o)=>{n({goal_id:e}).then((t=>{let{success:n}=t;if(!n)return r.push(e);a.push(e)})).catch((()=>r.push(e))).then((()=>t(!0)))}))));return await Promise.all(i).finally((()=>{o(),t(!1)})),r.length>0&&s.b.error(Object(c.b)("goals.bonuses_not_generated",{count:r.length})),a.length>0&&s.b.success(Object(c.b)("goals.bonuses_generated_successfully",{count:a.length})),{successes:a.length,failures:r.length}}),[n]),{loading:e}]}},2985:function(e,t,n){"use strict";n.r(t);var o=n(0),c=n(2921),s=n(1813),a=n(50),r=n(250),i=n(579),l=n(599),b=n(767),d=n(1809),u=n(116),j=n(3034),p=n(2854),_=n(2843),g=n(691),O=n(1417),h=n(1418),m=n(27),f=n(1159),v=n(22);const w=e=>{let{item:t}=e;const[n,c]=Object(o.useState)(!1),s=Object(m.a)((e=>e.current_user.permissions)),i=Object(b.b)((e=>e.filters)),l=Object(b.b)((e=>e.forceRefetch)),w=Object(b.b)((e=>e.goalDrawerRef)),[y,{loading:x}]=Object(f.a)(),[k,{loading:C}]=Object(O.a)(),[E,{loading:$}]=Object(h.a)(),I=Object(o.useCallback)((()=>{var e;s.can_edit_goal?(c(!1),null===(e=w.current)||void 0===e||e.open(i.period,t.employee.id)):u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"))}),[i.period,w,t.employee.id,s.can_edit_goal]),M=Object(o.useCallback)((async e=>{const{successes:t}=await y(e);t>0&&l()}),[y,l]),L=Object(o.useCallback)((e=>{s.can_destroy_goal?u.c.confirm({centered:!0,maskClosable:!0,className:"webook-modal",title:Object(a.b)("words.attention"),content:Object(a.b)("phrases.confirm_delete",{model:Object(a.b)("words.goal").toLocaleLowerCase(),context:"female"}),okText:Object(a.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(a.b)("verbs.cancel"),onOk:()=>{const t=e.map((e=>e.id));M(t)}}):u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"))}),[M,s.can_destroy_goal]),T=Object(o.useCallback)((async e=>{if(!s.is_admin)return void u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"));const t=e.reduce(((e,t)=>t.bonification?[...e,t.bonification.id]:e),[]),{successes:n}=await k(t);n>0&&l()}),[k,l,s.is_admin]),S=Object(o.useCallback)((async e=>{if(!s.is_admin)return void u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"));const t=e.reduce(((e,t)=>t.pay_bonus&&t.bonus_value_cents>0&&t.current_value>=t.value&&!t.bonification?[...e,t.id]:e),[]);if(!t.length)return void u.b.warning(Object(a.b)("goals.no_goals_available"));const{successes:n}=await E(t);n>0&&l()}),[E,l,s.is_admin]),B=Object(o.useMemo)((()=>t.goals.some((e=>e.pay_bonus&&e.bonus_value_cents>0&&e.current_value>=e.value))),[t.goals]),P=Object(o.useMemo)((()=>t.goals.some((e=>{var t;return!(null===(t=e.bonification)||void 0===t||!t.id)}))),[t.goals]),N=Object(o.useMemo)((()=>{const e=[{key:"edit_goals",icon:Object(v.jsx)(j.a,{}),label:Object(a.b)("verbs.edit"),onClick:I},{key:"destroy",icon:Object(v.jsx)(p.a,{}),onClick:()=>L(t.goals),label:Object(a.b)("verbs.delete"),danger:!0}];return B&&(e.push({type:"divider"}),e.push({key:"generate_bonification",icon:Object(v.jsx)(_.a,{}),label:Object(a.b)("goals.generate_bonus_other"),onClick:()=>S(t.goals)})),P&&(e.push({type:"divider"}),e.push({key:"destroy_bonification",icon:Object(v.jsx)(p.a,{}),label:Object(a.b)("goals.delete_bonus_other"),onClick:()=>T(t.goals),danger:!0})),e}),[P,B,L,T,I,S,t.goals]);return Object(v.jsx)(d.a,{menu:{items:N,disabled:x||$||C},trigger:["click"],open:n,onOpenChange:c,getPopupContainer:e=>e.parentElement||document.body,children:Object(v.jsx)(r.i,{children:Object(v.jsx)(g.a,{})})})};w.displayName="EmployeeActions";var y=w,x=n(887),k=n(19);var C=()=>{const e=Object(b.b)((e=>e.filters));return Object(o.useMemo)((()=>[{title:Object(a.b)("words.employee"),key:"employee",dataIndex:"employee",ellipsis:!0,width:"40%",render:e=>Object(v.jsxs)($,{children:[Object(v.jsx)(E,{src:e.small_thumb_url,blurhash:e.avatar_blurhash}),Object(v.jsx)(r.h,{$left:7,$block:!0,$textEllipsis:!0,children:e.name})]})},{title:Object(a.b)("words.period"),key:"",dataIndex:"",width:"15%",render:()=>`${e.period.format("MMMM/YYYY")}`},{title:Object(a.b)("words.progress"),key:"goals",width:"45%",dataIndex:"goals",render:t=>{const n=t.reduce(((e,t)=>{const n=t.current_value>t.value?t.value:t.current_value;return 0===n?e:e+Object(i.j)(t.value,n)}),0);return Object(v.jsx)(x.a,{percent:n/t.length,period:e.period})}},{title:Object(a.b)("words.action_other"),dataIndex:"",width:100,align:"center",key:"actions_column",render:(e,t)=>Object(v.jsx)(y,{item:t})}]),[e.period])};const E=Object(k.d)(l.a).withConfig({componentId:"wb__sc-4kr44w-0"})(["width:40px;height:40px;"]),$=k.d.div.withConfig({componentId:"wb__sc-4kr44w-1"})(["display:flex;justify-content:left;width:100%;align-items:center;padding:0;"]);var I=n(1194),M=n(1193);const L=e=>{var t;let{goal:n}=e;const[c,s]=Object(o.useState)(!1),i=Object(m.a)((e=>e.current_user.permissions)),l=Object(b.b)((e=>e.forceRefetch)),[j]=Object(f.a)(),[O,{loading:h}]=Object(I.a)(),[w,{loading:y}]=Object(M.a)(),x=null===(t=n.bonification)||void 0===t?void 0:t.id,k=Object(o.useCallback)((async e=>{const{successes:t,failures:n}=await j(e);return t>0&&l(),{successes:t,failures:n}}),[j,l]),C=Object(o.useCallback)((e=>{i.can_destroy_goal?(s(!1),u.c.confirm({centered:!0,maskClosable:!0,className:"webook-modal",title:Object(a.b)("words.attention"),content:Object(a.b)("phrases.confirm_delete",{model:Object(a.b)("words.goal").toLocaleLowerCase(),context:"female"}),okText:Object(a.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(a.b)("verbs.cancel"),onOk:()=>k(e)})):u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"))}),[k,i.can_destroy_goal]),E=Object(o.useCallback)((async e=>{const{success:t}=await w(e);t&&(s(!1),l())}),[w,l]),$=Object(o.useCallback)((()=>{i.is_admin?(s(!1),u.c.confirm({centered:!0,maskClosable:!0,className:"webook-modal",title:Object(a.b)("words.attention"),content:Object(a.b)("phrases.confirm_delete",{model:Object(a.b)("words.bonification").toLocaleLowerCase(),context:"female"}),okText:Object(a.b)("phrases.yes_delete"),okType:"danger",cancelText:Object(a.b)("verbs.cancel"),onOk:()=>E(x)})):u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"))}),[x,E,i.is_admin]),L=Object(o.useCallback)((async e=>{if(!i.is_admin)return void u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"));if(n.current_value<n.value)return void u.b.warning(Object(a.b)("goals.goal_not_reached"));if(!n.pay_bonus)return void u.b.warning(Object(a.b)("goals.bonus_payment_disabled"));if(n.bonus_value_cents<=0)return void u.b.warning(Object(a.b)("goals.bonus_value_greater_than_zero"));const{success:t}=await O({goal_id:e});t&&(s(!1),l())}),[l,O,n.bonus_value_cents,n.current_value,n.pay_bonus,n.value,i.is_admin]),T=Object(o.useMemo)((()=>{const e=[{key:"destroy_goal",icon:Object(v.jsx)(p.a,{}),label:`${Object(a.b)("verbs.delete")} ${Object(a.b)("words.goal").toLocaleLowerCase()}`,onClick:()=>C([n.id]),danger:!0},{type:"divider"}];return x?e.push({key:"destroy_bonification",icon:Object(v.jsx)(p.a,{}),onClick:$,label:Object(a.b)("goals.delete_bonus"),danger:!0}):e.push({key:"generate_bonification",icon:Object(v.jsx)(_.a,{}),label:Object(a.b)("goals.generate_bonus"),onClick:()=>L(n.id)}),e}),[x,n.id,C,$,L]);return Object(v.jsx)(d.a,{menu:{items:T,disabled:h||y},trigger:["click"],open:c,onOpenChange:s,getPopupContainer:e=>e.parentElement||document.body,children:Object(v.jsx)(r.i,{className:"link",children:Object(v.jsx)(g.a,{})})})};L.displayName="ActionIcon";var T=Object(o.memo)(L);var S=()=>{const e=Object(m.a)((e=>e.current_user.permissions)),t=Object(b.b)((e=>e.goalDrawerRef)),n=Object(b.b)((e=>e.filters)),c=Object(k.f)();return Object(o.useMemo)((()=>[{title:Object(a.b)("words.item"),key:"goal_products",dataIndex:"goal_products",ellipsis:!0,width:"30%",render:(o,s)=>"fake_item"===s.id?Object(v.jsxs)(r.i,{onClick:()=>{var o;e.can_create_goal?null===(o=t.current)||void 0===o||o.open(n.period,s.employee.id):u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"))},children:[Object(v.jsx)(_.a,{})," ",Object(a.b)("goals.add_goal")]}):Object(v.jsx)(r.i,{onClick:()=>{var o;e.can_edit_goal?null===(o=t.current)||void 0===o||o.open(n.period,s.employee.id):u.b.warning(Object(a.b)("phrases.no_permission_to_do_this"))},style:{color:c.colors.default_text,width:"100%"},children:o.map((e=>{let{id:t,inventory_product:n}=e;return Object(v.jsxs)($,{children:[Object(v.jsx)(l.a,{size:25,type:"image",src:n.image_url,blurhash:n.image_blurhash}),Object(v.jsx)(r.h,{$left:5,$fullWidth:!0,$block:!0,$textEllipsis:!0,children:n.description})]},t)}))})},{title:Object(a.b)("words.current"),key:"current_value",dataIndex:"current_value",width:"15%",render:(e,t)=>{let{value_type:n,id:o}=t;return"fake_item"===o?"":"quantity"===n?e:Object(i.d)(e)}},{title:Object(a.b)("words.goal"),key:"value",width:"15%",dataIndex:"value",render:(e,t)=>{let{value_type:n,id:o}=t;return"fake_item"===o?"":"quantity"===n?e:Object(i.d)(e)}},{title:Object(a.b)("words.progress"),key:"progress",width:"40%",render:(e,t)=>{let{value:o=0,id:c,current_value:s=0}=t;if("fake_item"===c)return null;const a=Object(i.j)(o,s>o?o:s);return Object(v.jsx)(x.a,{percent:a,period:n.period})}},{title:Object(a.b)("words.action",{count:2}),width:100,key:"action_columns",align:"center",render:(e,t)=>"fake_item"===t.id?"":Object(v.jsx)(T,{goal:t})}]),[n.period,t,e.can_create_goal,e.can_edit_goal,c.colors.default_text])},B=n(616);const P={id:"fake_item",goal_products:[{inventory_product:{description:Object(a.b)("verbs.add")}}],employee:{id:""},value_type:"quantity",value:0,current_value:0,pay_bonus:!1,bonus_value_cents:0},N=e=>{const{data:t,loading:n}=e,r=C(),i=S(),l=Object(o.useCallback)((e=>{const{goals:t}=e;return Object(v.jsx)(c.a,{rowKey:"id",columns:i,loading:!1,dataSource:[...t,{...P,employee:t[0].employee}],style:{width:"100%"},locale:{emptyText:Object(v.jsx)(s.a,{image:s.a.PRESENTED_IMAGE_SIMPLE,description:Object(a.b)("phrases.empty")})},pagination:!1})}),[i]);return Object(v.jsx)(R,{columns:r,dataSource:t,loading:n,rowKey:e=>e.employee.id,locale:{emptyText:Object(v.jsx)(s.a,{image:s.a.PRESENTED_IMAGE_SIMPLE,description:Object(a.b)("phrases.empty")})},expandable:{expandedRowRender:l},pagination:!1})};N.displayName="TableDataDesktop";t.default=N;const R=Object(k.d)(B.b).withConfig({componentId:"wb__sc-14z4i04-0"})([".ant-table-expanded-row-level-1 > .ant-table-cell{background-color:white;}.ant-table-tbody{vertical-align:top;}"])},691:function(e,t,n){"use strict";var o=n(13),c=n(0),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},a=n(71),r=function(e,t){return c.createElement(a.a,Object(o.a)({},e,{ref:t,icon:s}))},i=c.forwardRef(r);t.a=i},886:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n(53),c=n.n(o);const s=e=>{let{period:t}=e;const n=c()().daysInMonth(),o=n-c()().date(),s=Math.round(o/n*100),a=t.isBefore(c()(),"month");return t.isAfter(c()(),"month")?0:a?100:100-s}},887:function(e,t,n){"use strict";n.d(t,"b",(function(){return p}));var o=n(0),c=n(50),s=n(579),a=n(250),r=n(852),i=n(1805),l=n(19),b=n(886),d=n(22);const u=e=>{let{percent:t=0,period:n}=e;const[a,i]=Object(o.useState)(0),l=Object(o.useRef)(null),u=Object(b.a)({period:n}),m=0===t,f=t>=u,v=u-t<=25;Object(o.useEffect)((()=>{const e=()=>{if(l.current){const e=l.current.querySelector(".ant-progress-inner");if(!e)return;i(e.clientWidth)}};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const w=j(u,a);let y=m?"not_started":f?"on_track":v?"behind":"at_risk";const{color:x,description:k}=p(y);return Object(d.jsxs)(_,{ref:l,children:[Object(d.jsx)(g,{percent:t,strokeColor:x,size:["100%",24],trailColor:"#cbd0d6",format:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(s.u)(e,{symbol_position:"right",precision:0})}}),Object(d.jsx)(r.a,{trigger:["click","hover"],title:`${Object(c.b)("words.expected")}: ${u}%`,children:Object(d.jsx)(O,{expected:w})}),Object(d.jsx)(h,{children:k})]})};u.displayName="ProgressBar",t.a=u;const j=(e,t)=>Math.round(e/100*t),p=e=>({not_started:{color:"#cbd0d6",description:Object(c.b)("goals.not_started")},on_track:{color:"#63cd00",description:Object(c.b)("goals.on_track")},behind:{color:"#feac41",description:Object(c.b)("goals.behind")}}[e]||{color:"#ef6e6e",description:Object(c.b)("goals.at_risk")}),_=l.d.div.withConfig({componentId:"wb__sc-3aqn2h-0"})(["position:relative;display:flex;align-items:center;width:100%;"]),g=Object(l.d)(i.a).withConfig({componentId:"wb__sc-3aqn2h-1"})(["width:100%;.ant-progress-inner{border-radius:2px !important;}.ant-progress-bg{border-radius:2px !important;}"]),O=l.d.div.withConfig({componentId:"wb__sc-3aqn2h-2"})(["position:absolute;top:0;bottom:0;width:3px;height:24px;background-color:#8b8d8f;left:",";"],(e=>Object(l.c)(["","px"],e.expected))),h=Object(l.d)(a.h).withConfig({componentId:"wb__sc-3aqn2h-3"})(["position:absolute;left:10px;top:2px;color:#FFFFFF;"])}}]);
//# sourceMappingURL=89.63816234.chunk.js.map