{% extends "base_dashboard.html" %}
{% block title %}Equipe{% endblock %}
{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  .header-gradient{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:1.5rem;border-radius:14px;margin-bottom:1rem}
  .cardx{background:#111827;border:1px solid #223148;border-radius:12px;padding:1rem;margin-bottom:1rem}
  label{font-weight:600;color:#cbd5e1;font-size:.9rem}
  input,select{width:100%;padding:.6rem;border-radius:10px;border:1px solid #334155;background:#0f172a;color:#e2e8f0}
</style>
{% endblock %}
{% block content %}

<div class="header-gradient">
  <h2 style="margin:0">Equipe</h2>
  <p class="subtitle" style="opacity:.9">Gerencie acessos e papéis da sua equipe</p>
  </div>

<div class="cardx">
  <h3 style="margin-top:0">Adicionar membro</h3>
  <form method="post" style="display:grid;grid-template-columns:1fr 1fr;gap:.8rem;align-items:end">
    {% csrf_token %}
    {{ form.email.label_tag }}{{ form.email }}
    {{ form.full_name.label_tag }}{{ form.full_name }}
    {{ form.phone_number.label_tag }}{{ form.phone_number }}
    {{ form.role.label_tag }}{{ form.role }}
    <label style="grid-column:1 / -1"><input type="checkbox" name="is_active" checked> Ativo</label>
    {{ form.password.label_tag }}{{ form.password }}
    <div style="grid-column:1 / -1;display:flex;gap:.8rem"><button class="button" type="submit">Adicionar</button></div>
  </form>
</div>

<div class="cardx">
  <h3 style="margin-top:0">Membros</h3>
  {% if members %}
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>E-mail</th>
        <th>Papel</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for m in members %}
      <tr>
        <td>{{ m.user.get_full_name|default:m.user.email }}</td>
        <td>{{ m.user.email }}</td>
        <td>
          <form action="{% url 'dashboard:team_update' m.id %}" method="post" style="display:flex;gap:.5rem;align-items:center">
            {% csrf_token %}
            <select name="role">
              {% for v,lbl in m.Role.choices %}
                <option value="{{ v }}" {% if m.role == v %}selected{% endif %}>{{ lbl }}</option>
              {% endfor %}
            </select>
            <label><input type="checkbox" name="is_active" value="on" {% if m.is_active %}checked{% endif %}> ativo</label>
            <button type="submit" class="button">Salvar</button>
          </form>
        </td>
        <td>{{ m.is_active|yesno:"Sim,Não" }}</td>
        <td>
          <form action="{% url 'dashboard:team_remove' m.id %}" method="post" style="display:inline">
            {% csrf_token %}
            <button type="submit" class="button">Desativar</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>Nenhum membro cadastrado.</p>
  {% endif %}
</div>
{% endblock %}
